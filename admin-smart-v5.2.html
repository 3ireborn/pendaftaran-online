<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NPA Smart System ‚Äî Admin Pusat v5.2 (AI Generator Edition)</title>
<meta name="theme-color" content="#0b3d91">
<link rel="icon" href="./asset/npa-icon-512.png" type="image/png">
<style>
:root{
  --brand:#0b3d91; --brand-2:#183a73; --bg:#f5f8ff; --card:#fff; --text:#102336;
  --muted:#6d7a90; --ok:#1ec28b; --warn:#ffb020; --line:#e7eeff;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
.wrap{max-width:1000px;margin:20px auto;padding:16px}
h1{display:flex;gap:10px;align-items:center;font-weight:800;color:var(--brand);margin:0 0 6px}
h2{margin:18px 0 10px;color:var(--brand-2)}
.card{background:var(--card);border-radius:16px;box-shadow:0 6px 20px rgba(0,30,80,.08);padding:16px;margin-bottom:14px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:780px){.row{grid-template-columns:1fr}}
label{display:block;font-size:.9rem;color:var(--muted);margin:4px 0 6px}
input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px}
input:focus,select:focus,textarea:focus{border-color:#b9ccff;box-shadow:0 0 0 3px rgba(11,61,145,.08);outline:none}
.btn{appearance:none;border:0;border-radius:10px;background:var(--brand);color:#fff;font-weight:800;padding:11px 16px;cursor:pointer}
.btn.secondary{background:#eaf2ff;color:var(--brand)}
.btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--line)}
.badge{display:inline-block;font-size:.78rem;background:#eef5ff;color:#335;padding:6px 8px;border-radius:999px}
.links a{margin-right:8px}
.small{font-size:.9rem;color:var(--muted)}
hr{border:0;border-top:1px dashed var(--line);margin:14px 0}
.ul{margin:8px 0 0 18px}
.footer{margin:20px 0 40px;text-align:center;color:#6f7d96}
.kv{display:flex;gap:8px;align-items:center}
.kv .dot{width:10px;height:10px;border-radius:50%;background:#bbb}
.kv .dot.ok{background:var(--ok);box-shadow:0 0 0 3px rgba(30,194,139,.22)}
.kv .dot.warn{background:var(--warn);box-shadow:0 0 0 3px rgba(255,176,32,.22)}
.list .item{border:1px solid var(--line);border-radius:14px;padding:12px 12px;margin:8px 0;background:#fff}
.item .name{font-weight:800}
.item .meta{color:#6c7a90;font-size:.9rem}
.item .links a{display:inline-block;margin:8px 8px 0 0}
blockquote{background:#f7faff;border-left:4px solid var(--brand);padding:10px;border-radius:10px}
.flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.right{margin-left:auto}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
.hidden{display:none}

/* BOT monitor */
#npa-bot{position:fixed;left:12px;right:12px;bottom:12px;z-index:9999;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
#npa-bot .bar{background:var(--brand);color:#fff;border-radius:14px;padding:10px 12px;display:flex;align-items:center;gap:10px;box-shadow:0 8px 22px rgba(0,30,80,.18)}
#npa-bot .right{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
#npa-bot .btn{background:#fff;color:var(--brand);border:0;border-radius:9px;font-weight:800;padding:8px 12px;cursor:pointer}
#npa-bot .btn.alt{background:#eaf2ff}
#npa-bot .dot{width:10px;height:10px;border-radius:50%;display:inline-block;background:#bbb}
#npa-bot .dot.ok{background:var(--ok);box-shadow:0 0 0 3px rgba(30,194,139,.25)}
#npa-bot .dot.warn{background:var(--warn);box-shadow:0 0 0 3px rgba(255,176,32,.25)}
#npa-log{margin-top:8px;background:#f7faff;border:1px solid #e2eeff;border-radius:10px;max-height:34vh;overflow:auto;padding:8px 10px;color:#123}
#npa-bot label{display:flex;align-items:center;gap:6px}
#npa-bot input[type=checkbox]{width:18px;height:18px;accent-color:#18a957}
#npa-bot.min .log-wrap{display:none}
#npa-bot .tiny{font-size:.78rem;color:#dfe8ff}
</style>
</head>
<body>
<div class="wrap">
  <h1>üß≠ NPA Smart System ‚Äî Admin Pusat v5.2 (AI Generator)</h1>
  <div class="small">Smart Auto ‚Ä¢ AI Follow-Up ‚Ä¢ Leader Links ‚Ä¢ GitHub Sync ‚Ä¢ Fonnte BOT Monitor</div>

  <!-- Tambah Leader -->
  <div class="card">
    <h2>‚ûï Tambah Mitra/Leader</h2>
    <div class="row">
      <div><label>Nama Leader</label><input id="in-name" placeholder="cth: Sugiarto Kurniawan"></div>
      <div><label>No. WhatsApp (format 628...)</label><input id="in-wa" placeholder="cth: 6285xxxxxxxxx"></div>
    </div>
    <div class="flex">
      <button class="btn" id="btn-add">Tambah ke Daftar</button>
      <div class="small">ID unik (inisial) & kode otomatis. Slug = nama-ke-bawah.</div>
    </div>
  </div>

  <!-- Sinkron GitHub -->
  <div class="card">
    <h2>üå•Ô∏è Sinkronisasi ke GitHub</h2>
    <div class="row">
      <div><label>GitHub Owner/Org</label><input id="gh-owner" value="3ireborn"></div>
      <div><label>Repository</label><input id="gh-repo" value="pendaftaran-online"></div>
    </div>
    <div class="row">
      <div><label>Path file leaders.json</label><input id="gh-path" value="data/leaders.json"></div>
      <div><label>Token GitHub (disimpan lokal)</label><input id="gh-token" placeholder="github_pat_xxx (optional)"></div>
    </div>
    <div class="flex">
      <button class="btn secondary" id="btn-save-gh">Simpan Token</button>
      <button class="btn" id="btn-sync">Sinkron ke GitHub</button>
      <div class="small">Token hanya disimpan di perangkat ini (localStorage).</div>
    </div>
  </div>

  <!-- Daftar Leader -->
  <div class="card">
    <h2>üìí Daftar Leader</h2>
    <div id="leaders-list" class="list small">Memuat data‚Ä¶</div>
    <div class="small">Klik link untuk share ke WA. LP Master / LP Hot / Form Pendaftaran (Resmi SOP).</div>
  </div>

  <!-- Prospek Queue (Follow-Up 1-7-9) -->
  <div class="card">
    <h2>üìû Prospek (Auto Follow-Up 1-7-9)</h2>
    <div class="row">
      <div><label>Nama Prospek</label><input id="fu_name" placeholder="cth: Andi Saputra"></div>
      <div><label>No WA Prospek (62‚Ä¶)</label><input id="fu_phone" placeholder="cth: 62812xxxxxxx"></div>
    </div>
    <div class="flex">
      <button class="btn" id="fu_add">Tambah ke Antrian</button>
      <span class="small" id="fu_msg"></span>
      <span class="small right" id="fu_stat">Antrian: 0</span>
    </div>
    <blockquote class="small">
      Sistem akan follow-up otomatis di H+1, H+7, H+9 (pukul 08:00 WIB).  
      *Sumber leads opsional dari <code class="mono">data/leads.json</code> jika tersedia.*
    </blockquote>
  </div>

  <!-- AI Text Engine -->
  <div class="card">
    <h2>üß† AI Text Generator (Local, tanpa server)</h2>
    <div class="row">
      <div>
        <label>Mode Gaya Pesan</label>
        <select id="ai_mode">
          <option value="motivational">Motivational</option>
          <option value="business">Business</option>
          <option value="personal">Personal</option>
          <option value="fun">Fun</option>
        </select>
      </div>
      <div>
        <label>Contoh Nama Prospek (untuk preview)</label>
        <input id="ai_name" placeholder="cth: Rani">
      </div>
    </div>
    <label>Preview Pesan</label>
    <textarea id="ai_preview" rows="4" placeholder="Klik Generate untuk melihat contoh teks AI‚Ä¶"></textarea>
    <div class="flex">
      <button class="btn secondary" id="ai_generate">üîÑ Generate</button>
      <button class="btn ghost" id="ai_copy">üìã Copy</button>
      <div class="small">AI bekerja pakai template cerdas + variasi random, personalisasi nama & leader.</div>
    </div>
  </div>

  <!-- AI Tools -->
  <div class="card">
    <h2>üß† AI Tools (Shortcut)</h2>
    <div class="flex links">
      <a class="badge" href="./tools/npa-digital-assistant.html" target="_blank">NPA Digital Assistant</a>
      <a class="badge" href="./tools/ai-fb-generator.html" target="_blank">FB Generator</a>
      <a class="badge" href="./tools/ai-analyzer.html" target="_blank">Konten Analyzer</a>
      <a class="badge" href="./tools/ai-seo.html" target="_blank">SEO Helper</a>
      <a class="badge" href="./followup-demo.html" target="_blank">FollowUp Demo</a>
    </div>
    <hr>
    <blockquote>Beberapa tools butuh file pendukung ‚Äî pastikan sudah tersedia agar tidak 404.</blockquote>
  </div>

  <div class="footer">
    Powered by <b>NPA Smart System</b> √ó <b>3iReborn</b> ‚Äî ‚ÄúKitaNganggur Punya Penghasilan‚Äù üöÄ
  </div>
</div>

<!-- ====== BOT MONITOR (panel bawah) ====== -->
<div id="npa-bot">
  <div class="bar">
    <span class="dot warn" id="bot-dot"></span>
    <b>NPA BOT</b>
    <span class="tiny" id="bot-clock">--:--:-- WIB</span>
    <div class="right">
      <button class="btn alt" id="bot-set">Set Token</button>
      <button class="btn" id="bot-test">Tes</button>
      <button class="btn" id="bot-bc">Broadcast</button>
      <button class="btn" id="bot-fu">FollowUp Now</button>
      <button class="btn alt" id="bot-min">‚§µÔ∏è</button>
      <label class="small"><input type="checkbox" id="bot-auto" checked> Auto 06:00</label>
      <label class="small"><input type="checkbox" id="fu-auto" checked> Auto FollowUp</label>
      <label class="small"><input type="checkbox" id="ai-auto" checked> Auto AI</label>
    </div>
  </div>
  <div class="log-wrap">
    <div id="npa-log" class="small mono"></div>
    <div class="small" style="text-align:center;margin-top:6px">
      #Terkirim dengan üíû dari NPA Smart System, Semangat Menembus Batas üöÄ
    </div>
  </div>
</div>

<script>
// ================== KONFIGURASI LINK ==================
const LP = {
  MASTER : "./master-lp.html?leader=",
  HOT    : "./lp-eka-mini.html?leader=",
  FORM   : "./index-v2.html?leader=" // üîí Form Resmi SOP
};
const TZ = "Asia/Jakarta";
const DATA_LEADERS = "./data/leaders.json";
const DATA_LEADS   = "./data/leads.json";   // optional, kalau ada

// ================== UTIL ==================
const $ = sel => document.querySelector(sel);
const nowWIB = () => new Date(new Date().toLocaleString("en-US",{timeZone:TZ}));
function prettyLog(s){ const box=$("#npa-log"); if(!box) return; const t=nowWIB().toLocaleTimeString("id-ID",{hour12:false}); const el=document.createElement("div"); el.textContent=`[${t}] ${s}`; box.prepend(el); }
function slugify(str){ return String(str||"").trim().toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"); }
function setLocal(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function getLocal(k,def){ try{const v=JSON.parse(localStorage.getItem(k)); return v??def;}catch{ return def; } }

// ================== STATE ==================
let leaders = [];
let prospects = []; // {name, phone, first_at, sent:{d1,d7,d9}}

// ================== LOAD LEADERS ==================
async function loadLeaders(){
  try{
    const res = await fetch(DATA_LEADERS,{cache:"no-store"});
    if(res.ok){ leaders = await res.json(); setLocal("leaders_cache",leaders); }
    else{ leaders = getLocal("leaders_cache",[]); }
  }catch{ leaders = getLocal("leaders_cache",[]); }
  renderLeaders();
}
function renderLeaders(){
  const box=$("#leaders-list");
  if(!leaders?.length){ box.innerHTML=`<div class="small">Belum ada data leader.</div>`; return; }
  box.innerHTML = leaders.map((L,i)=>{
    const master=`${LP.MASTER}${L.slug}`;
    const hot   =`${LP.HOT}${L.slug}`;
    const form  =`${LP.FORM}${L.slug}`;
    return `<div class="item">
      <div class="flex">
        <div class="name">#${i+1} ${L.name}</div>
        <div class="right meta">WA: <a href="https://wa.me/${L.phone}" target="_blank">${L.phone}</a> ‚Ä¢ slug: <span class="mono">${L.slug}</span></div>
      </div>
      <div class="links">
        <a class="badge" href="${master}" target="_blank">üåê LP Master</a>
        <a class="badge" href="${hot}" target="_blank">üî• LP Hot</a>
        <a class="badge" href="${form}" target="_blank">üìù Pendaftaran</a>
      </div>
    </div>`;
  }).join("");
}

// ================== ADD LEADER ==================
$("#btn-add").onclick = ()=>{
  const name=$("#in-name").value.trim();
  const phone=$("#in-wa").value.trim();
  if(!name||!/^(62)\d{6,}$/.test(phone)){ alert("Nama & no WA (62...) wajib diisi."); return; }
  const initials=name.split(" ").map(w=>w[0]||"").join("").toUpperCase().slice(0,2);
  const id=initials+String(Math.floor(100+Math.random()*900));
  const code=String((leaders?.length||0)+1).padStart(3,"0");
  const slug=slugify(name);
  leaders=[...leaders,{id,code,name,phone,slug}];
  setLocal("leaders_cache",leaders);
  renderLeaders();
  $("#in-name").value=""; $("#in-wa").value="";
  alert("Leader ditambahkan (lokal). Klik Sinkron untuk simpan ke GitHub.");
};

// ================== GITHUB SYNC ==================
const GH={ ownerInp:$("#gh-owner"), repoInp:$("#gh-repo"), pathInp:$("#gh-path"), tokenInp:$("#gh-token") };
GH.tokenInp.value = getLocal("gh_token","")||"";
$("#btn-save-gh").onclick=()=>{ setLocal("gh_token", GH.tokenInp.value.trim()); alert("Token GitHub disimpan lokal."); };
$("#btn-sync").onclick = async ()=>{
  const owner=GH.ownerInp.value.trim(), repo=GH.repoInp.value.trim(), path=GH.pathInp.value.trim().replace(/^\/+/,""), token=GH.tokenInp.value.trim();
  if(!owner||!repo||!path||!token){ alert("Owner, Repo, Path & Token wajib diisi."); return; }
  try{
    const meta=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?t=${Date.now()}`,{headers:{Authorization:`Bearer ${token}`}}); let sha;
    if(meta.ok){ const js=await meta.json(); sha=js.sha; }
    const content=btoa(unescape(encodeURIComponent(JSON.stringify(leaders,null,2))));
    const body={message:`Update leaders.json (Admin v5.2)`,content,sha};
    const res=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`,{
      method:"PUT", headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}, body:JSON.stringify(body)
    });
    if(!res.ok) throw new Error("HTTP "+res.status);
    alert("Sinkron GitHub BERHASIL ‚úÖ");
  }catch(e){ console.error(e); alert("Gagal sinkron ke GitHub. Cek token/izin & path."); }
};

// ================== PROSPECT QUEUE (1-7-9) ==================
function fu_load(){ return getLocal("prospects_queue",[]); }
function fu_save(q){ setLocal("prospects_queue",q); }
function fu_updateStat(){ const el=$("#fu_stat"); if(!el) return; const q=fu_load(); const pending=q.filter(p=>!(p.sent?.d1&&p.sent?.d7&&p.sent?.d9)).length; el.textContent=`Antrian: ${pending} (total ${q.length})`; }
$("#fu_add").onclick=()=>{
  const name=($("#fu_name").value||"").trim(); const phone=($("#fu_phone").value||"").trim();
  const msg=$("#fu_msg");
  if(!/^62\d{6,}$/.test(phone)){ msg.textContent="Isi nomor WA format 62‚Ä¶"; return; }
  const q=fu_load(); if(q.some(p=>p.phone===phone)){ msg.textContent="Nomor sudah ada di antrian"; return; }
  q.push({name,phone,first_at:nowWIB().toISOString(),sent:{d1:false,d7:false,d9:false}});
  fu_save(q); fu_updateStat(); $("#fu_name").value=""; $("#fu_phone").value=""; msg.textContent="Ditambahkan ‚úî";
};
fu_updateStat();

// ================== AI GENERATOR (local) ==================
const AI_BANK={
  motivational:[
    "Halo {nama}! Semangat ya ‚Äî setiap langkah kecilmu mendekatkan pada hasil besar üí™",
    "Pagi {nama} üå§Ô∏è, rezeki itu dijemput. Yuk lanjut selangkah bersama 3iReborn üíé",
    "{nama}, jangan takut memulai. Aku {leader}, siap dampingi kamu dari nol üöÄ"
  ],
  business:[
    "Halo {nama}, mari ubah niat jadi hasil nyata. 3iReborn siap bantu rencana finansialmu.",
    "{nama}, proteksi + investasi + income ‚Äî ini fondasi cerdas. Siap lanjut aku bantu eksekusi.",
    "Hi {nama}, malam ini ada Zoom ringkas bahas angka & simulasi. Minat join?"
  ],
  personal:[
    "{nama}, aku paham mulai itu nggak selalu mudah. Kamu nggak sendiri ‚Äî aku {leader} siap bantu ‚ù§Ô∏è",
    "Makasih ya {nama} sudah tertarik. Ayo jalan bareng pelan-pelan, kita sesuaikan ritmemu.",
    "{nama}, kapan enaknya ngobrol 10 menit? Biar aku dengerin kebutuhanmu dulu."
  ],
  fun:[
    "Woi {nama} üòÑ scroll WA boleh, tapi jangan lupa jemput peluang juga dong! Gas tipis-tipis!",
    "{nama}, malam ini ada Zoom seru. Santai tapi daging ‚Äî ikut yok! ü§ô",
    "Halo {nama}! Kalo bukan sekarang, kapan lagi? Kita buat langkah kecil bareng!"
  ]
};
function ai_pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function ai_generate(mode, nama, leaderName){
  const bank = AI_BANK[mode]||AI_BANK.motivational;
  return ai_pick(bank).replaceAll("{nama}", nama||"Sahabat").replaceAll("{leader}", leaderName||"Leader");
}
$("#ai_generate").onclick=()=>{
  const mode=$("#ai_mode").value;
  const nama=$("#ai_name").value.trim()||"Sahabat";
  const leader=(leaders[0]?.name)||"Sugiarto Kurniawan";
  $("#ai_preview").value = ai_generate(mode, nama, leader) + "\n\n#Terkirim dengan üíû dari NPA Smart System üöÄ";
};
$("#ai_copy").onclick=()=>{
  $("#ai_preview").select(); document.execCommand("copy"); alert("Tersalin ‚úî");
};

// ================== BOT FONNTE ==================
const BOT={ baseUrl:"https://api.fonnte.com/send", tokenKey:"fonnte_token",
  ownerPhone:"6285218453131",
  leadersPhones:[
    "6285218453131","6285932684440","62881011823140","6281388675615",
    "6282199558169","6281327498929","6281285949074","966563414575",
    "6586210326","6281236544821","6282252161911","6281236781273","6288293744431"
  ],
  msgs:[
    "üí´ Setiap hari adalah peluang baru untuk menjemput rezeki. Tetap semangat üí™",
    "üåÖ Jangan takut gagal, takutlah kalau berhenti mencoba.",
    "üî• Rezeki tak salah alamat. Terus bergerak dengan niat baik üíº",
    "üí™ Jadikan hari ini luar biasa dengan semangat yang tak biasa!",
    "üöÄ Kesuksesan lahir dari kebiasaan kecil tiap hari."
  ],
  autoHour:6, autoMinute:0
};
const dot=$("#bot-dot");
function botToken(){ return localStorage.getItem(BOT.tokenKey)||"" }
function paintDot(){ dot.className="dot "+(botToken()?"ok":"warn"); }
async function sendFonnte(target,message){
  const token=botToken(); if(!token) throw new Error("Token kosong");
  const res=await fetch(BOT.baseUrl,{method:"POST",headers:{Authorization:token,"Content-Type":"application/json"},body:JSON.stringify({target,message})});
  if(!res.ok) throw new Error("HTTP "+res.status);
}
$("#bot-set").onclick=()=>{
  const t=prompt("Masukkan token Fonnte:", botToken()||""); if(t!==null){ localStorage.setItem(BOT.tokenKey,t.trim()); paintDot(); prettyLog("üîê Token diperbarui."); }
};
$("#bot-test").onclick=async()=>{ try{ await sendFonnte(BOT.ownerPhone,"Tes kirim dari NPA BOT ‚úÖ"); prettyLog("‚úÖ Tes terkirim"); }catch(e){ prettyLog("‚ùå Tes gagal: "+e.message); } };
function rndMsg(){ return BOT.msgs[Math.floor(Math.random()*BOT.msgs.length)] }
async function manualBroadcast(){
  const msg=rndMsg()+"\n\nSmart Auto Broadcast by 3iReborn || NPA Team üöÄ";
  prettyLog("üöÄ Broadcast manual dimulai‚Ä¶");
  for(const p of BOT.leadersPhones){ try{ await sendFonnte(p,msg); prettyLog("‚úÖ "+p+" terkirim"); }catch(e){ prettyLog("‚ùå "+p+" gagal: "+e.message); } }
}
$("#bot-bc").onclick=()=>manualBroadcast();
$("#bot-min").onclick=()=>{ $("#npa-bot").classList.toggle("min"); };

// clock
setInterval(()=>{ $("#bot-clock").textContent = nowWIB().toLocaleTimeString("id-ID",{hour12:false})+" WIB"; },1000);

// ================== AUTO SCHEDULER ==================
let autoOn=true, fuAuto=true, aiAuto=true;
$("#bot-auto").onchange=e=>{ autoOn=e.target.checked; prettyLog("‚öôÔ∏è Auto 06:00 "+(autoOn?"ON":"OFF")); };
$("#fu-auto").onchange=e=>{ fuAuto=e.target.checked; prettyLog("‚öôÔ∏è Auto FollowUp "+(fuAuto?"ON":"OFF")); };
$("#ai-auto").onchange=e=>{ aiAuto=e.target.checked; prettyLog("üß† Auto AI "+(aiAuto?"ON":"OFF")); };

function atTime(h,m){ const t=nowWIB(); return t.getHours()===h && t.getMinutes()===m; }

// Auto motivasi 06:00
function tickMotivation(){
  if(!autoOn) return;
  if(atTime(BOT.autoHour,BOT.autoMinute) && nowWIB().getSeconds()<3){
    prettyLog("‚è∞ 06:00: broadcast otomatis‚Ä¶");
    manualBroadcast();
  }
}

// Auto Follow-Up 08:00 (1-7-9)
async function fu_send(phone,text){ try{ await sendFonnte(phone,text);
    prettyLog("üí¨ FU ‚Üí "+phone+" terkirim");
  }catch(e){
    prettyLog("üí• FU gagal ‚Üí "+phone+": "+e.message);
  }
}

function fu_tick(){
  if(!fuAuto) return;
  if(!(atTime(8,0) && nowWIB().getSeconds()<3)) return;

  const q=fu_load();
  if(!q.length) return;
  const today=nowWIB();
  const leaderName=(leaders[0]?.name)||"Leader";

  for(const p of q){
    const first=new Date(p.first_at);
    const days=Math.floor((today-first)/86400000);

    // Hari ke-1
    if(days>=1 && !p.sent.d1){
      const msg=ai_generate("personal", p.name||"Sahabat", leaderName)
        +"\n\n#Terkirim dengan üíû dari NPA Smart System üöÄ";
      fu_send(p.phone,msg);
      p.sent.d1=true;
    }

    // Hari ke-7
    if(days>=7 && !p.sent.d7){
      const msg=ai_generate("motivational", p.name||"Sahabat", leaderName)
        +"\nMalam ini ada Zoom 19:00 WIB, mau linknya?\n\n#NPA #3iReborn üöÄ";
      fu_send(p.phone,msg);
      p.sent.d7=true;
    }

    // Hari ke-9
    if(days>=9 && !p.sent.d9){
      const msg=ai_generate("business", p.name||"Sahabat", leaderName)
        +"\nKlik lanjut pendaftaran: https://3ireborn.github.io/pendaftaran-online/index-v2.html\n\n#ClosingTime";
      fu_send(p.phone,msg);
      p.sent.d9=true;
    }
  }
  fu_save(q);
  fu_updateStat();
}

// ================== OPTIONAL: IMPORT leads.json ==================
(async function initLeads(){
  try{
    const res=await fetch(DATA_LEADS,{cache:"no-store"});
    if(!res.ok) return;
    const leads=await res.json(); // [{name, phone, created_at}]
    const q=fu_load();
    let added=0;
    for(const L of leads||[]){
      if(!L?.phone) continue;
      if(q.some(p=>p.phone===L.phone)) continue;
      q.push({
        name:L.name||"",
        phone:L.phone,
        first_at:(L.created_at||nowWIB().toISOString()),
        sent:{d1:false,d7:false,d9:false}
      });
      added++;
    }
    if(added>0){
      fu_save(q);
      fu_updateStat();
      prettyLog("üì• Import leads.json: +"+added);
    }
  }catch(e){
    console.warn("Leads import skip:",e);
  }
})();
  // ================== LOOPING ==================
setInterval(()=>{
  tickMotivation();
  fu_tick();
},1000);

// ================== INIT ==================
function init(){
  paintDot();
  loadLeaders();
}
init();
</script>
</body>
</html>

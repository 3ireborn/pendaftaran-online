<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>NPA Smart v6.6 â€” Admin Leader</title>
<style>
  :root{--bg:#f7fbff;--card:#ffffff;--text:#0b3d91;--muted:#5f6b86;--line:#dfe8ff;--brand:#0b3d91;--accent:#21a47a}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Inter}
  .wrap{max-width:880px;margin:20px auto;padding:0 16px}
  h1{color:var(--brand);margin:6px 0 2px} .sub{color:var(--muted);margin:0 0 18px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0}
  label{font-weight:600;color:var(--brand);display:block;margin:8px 0 6px}
  input,select{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px;background:#fff}
  button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn{background:#eaf2ff;color:#0b3d91} .btn.primary{background:var(--brand);color:#fff} .btn.green{background:var(--accent);color:#fff}
  .grid{display:grid;gap:10px} @media(min-width:720px){.cols2{grid-template-columns:1fr 1fr}}
  .log{max-height:180px;overflow:auto;background:#f3f7ff;border:1px solid var(--line);border-radius:10px;padding:10px}
  .tag{display:inline-block;background:#eaf2ff;border:1px solid var(--line);color:#0b3d91;border-radius:999px;padding:4px 10px;font-size:.9rem}
</style>
</head>
<body>
<div class="wrap">
  <h1>NPA Smart v6.6 â€” Admin Leader</h1>
  <p class="sub">Buat 3 link & follow-up AI (otomatis 09:00 WIB). Tema putihâ€“biru lembut.</p>

  <div class="card">
    <b>Status FonNTE:</b> <span id="stToken" class="tag">Memeriksaâ€¦</span>
    <div class="sub">Token diambil otomatis bila pernah diset di perangkat ini (oleh admin pusat).</div>
  </div>

  <div class="card">
    <h3>ğŸ”— Buat 3 Link Otomatis</h3>
    <div class="grid cols2">
      <div><label>Nama Leader</label><input id="name" placeholder="cth: Sugiarto Kurniawan"></div>
      <div><label>No WA (62â€¦)</label><input id="wa" placeholder="62852xxxxxxxx"></div>
    </div>
    <label>Slug (opsional)</label>
    <input id="slug" placeholder="cth: ngangguraja">
    <div class="sub">ğŸ’¡ <b>Slug</b> adalah username unik (opsional), contoh: <b>ngangguraja</b>, <b>team-banten</b>.</div>
    <div class="grid cols2">
      <button class="btn primary" onclick="gen()">ğŸš€ Buat 3 Link</button>
      <button class="btn" onclick="copyAll()">ğŸ“‹ Salin Semua</button>
    </div>
    <div id="links" class="log" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <h3>ğŸ“ Tambah Prospek (opsional)</h3>
    <div class="grid cols2">
      <div><label>Nama</label><input id="pname" placeholder="cth: Andi"></div>
      <div><label>No WA (62â€¦)</label><input id="pwa" placeholder="62xxxxxxxxxx"></div>
    </div>
    <label>Premi</label>
    <select id="ppremi"><option>350.000</option><option>500.000</option><option>700.000</option><option>1.000.000</option><option>2.000.000</option></select>
    <div class="grid cols2" style="margin-top:8px">
      <button class="btn green" onclick="addPros()">+ Tambah Prospek</button>
      <button class="btn" onclick="showPros()">ğŸ‘€ Lihat Prospek</button>
    </div>
    <div id="pros" class="log" style="margin-top:10px"></div>
    <div class="sub">ğŸ¤– Follow-up AI otomatis H1/H3/H5/H7 jam 09:00 WIB.</div>
  </div>

  <div class="card">
    <h3>ğŸ—’ï¸ Log</h3>
    <div id="log" class="log"></div>
  </div>

  <p class="sub">Powered by NPA Smart System Ã— 3iReborn â€¢ Putihâ€“Biru Lembut</p>
</div>

<script>
const K={token:'npa_fonnte_token', prospects:'npa_prospects', leaders:'npa_leaders'};
const store={get:(k,d=null)=>{try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
function log(x){const L=document.getElementById('log');const t=new Date().toLocaleTimeString('id-ID',{hour12:false});L.innerHTML=`<div>[${t}] ${x}</div>`+L.innerHTML}
function paintToken(){document.getElementById('stToken').textContent = store.get(K.token)?'Aktif':'Tidak ada'}
paintToken();

function enc(s){return encodeURIComponent(s||'')}
function toSlug(s){return (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')||'my-link'}

function gen(){
  const name=document.getElementById('name').value.trim();
  const wa=document.getElementById('wa').value.trim();
  const slug=(document.getElementById('slug').value.trim()||toSlug(name));
  if(!name||!/^62\d{7,15}$/.test(wa)) return alert('Nama & WA (62â€¦) wajib benar.');
  const base='https://3ireborn.github.io/pendaftaran-online';
  const lp=`${base}/lp-master.html?name=${enc(name)}&wa=${enc(wa)}&slug=${enc(slug)}`;
  const hot=`${base}/lp-hot.html?name=${enc(name)}&wa=${enc(wa)}&slug=${enc(slug)}`;
  const form=`${base}/form-pendaftaran-v3.1.html?name=${enc(name)}&wa=${enc(wa)}&slug=${enc(slug)}`;
  document.getElementById('links').innerHTML =
    `ğŸŒ LP Master:\n${lp}\n\nğŸ”¥ LP Hot:\n${hot}\n\nğŸ“ Form Pendaftaran:\n${form}`;
  // simpan leader utama (untuk variabel {leader_name} saat follow-up)
  const arr=store.get(K.leaders,[]); if(!arr.find(x=>x.wa===wa)) {arr.push({name,wa}); store.set(K.leaders,arr)}
  log('3 link dibuat.');
}
function copyAll(){
  const t=document.getElementById('links').innerText; if(!t) return alert('Belum ada link.');
  navigator.clipboard.writeText(t).then(()=>alert('Disalin!'));
}

// Prospek & AI follow-up (09:00 WIB: H1/H3/H5/H7)
function getPros(){return store.get(K.prospects,[])}
function savePros(v){store.set(K.prospects,v)}
function addPros(){
  const name=document.getElementById('pname').value.trim();
  const wa=document.getElementById('pwa').value.trim();
  const premi=document.getElementById('ppremi').value;
  if(!name||!/^62\d{7,15}$/.test(wa)) return alert('Nama & WA (62â€¦) wajib benar.');
  const arr=getPros(); arr.push({name,wa,premi,addedAt:new Date().toISOString(),last:0}); savePros(arr);
  document.getElementById('pname').value=''; document.getElementById('pwa').value='';
  log('Prospek ditambahkan.');
}
function showPros(){
  const arr=getPros(); document.getElementById('pros').innerHTML =
    arr.length? arr.map(p=>`â€¢ ${p.name} â€” ${p.wa} (H${p.last||0})`).join('<br>') : '<i>Belum ada prospek.</i>';
}
async function sendFonnte(to,text){
  const token=store.get(K.token,''); if(!token) {log('Token kosong.'); throw new Error('Token kosong')}
  const fd=new FormData(); fd.append('target',to); fd.append('message',text);
  const res=await fetch('https://api.fonnte.com/send',{method:'POST',headers:{'Authorization':token},body:fd});
  if(!res.ok) throw new Error('HTTP '+res.status); return true;
}
function hhmm(){return new Date().toTimeString().slice(0,5)}
async function tick(){
  if(hhmm()!=='09:00') return;
  const arr=getPros(); if(!arr.length) return;
  const leader=(store.get(K.leaders,[])[0]||{name:'Leader'}).name;
  let changed=false;
  for(const p of arr){
    const day=Math.floor((Date.now()-Date.parse(p.addedAt))/86400000)+1;
    const map={1:`Halo ${p.name} ğŸ‘‹, saya ${leader} dari 3iReborn. Makasih sudah tertarik. Program ini bantu nabung + proteksi. Boleh aku pandu singkat?`,
               3:`Dengan premi mulai Rp ${p.premi}, kamu sudah mulai investasi jangka panjang. Aku jelasin 3 menit via WA call ya?`,
               5:`Sedikit testimoni: banyak yang mulai sambil kerja & terbantu. Aku kirim materi ringkas ya.`,
               7:`Malam ini 19:00 WIB ada Zoom gratis. Kalau sempat join, nanti aku pandu dari awal sampai beres. Siap?`};
    if(map[day] && (p.last||0)<day){
      try{await sendFonnte(p.wa,map[day]); p.last=day; changed=true; log(`H${day} terkirim ke ${p.wa}`);}
      catch(e){log(`Gagal H${day} âœ ${p.wa}: ${e.message}`)}
    }
  }
  if(changed) savePros(arr); showPros();
}
setInterval(tick,60*1000);
</script>
</body></html>

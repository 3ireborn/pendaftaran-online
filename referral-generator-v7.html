<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Referral Generator ‚Äî NPA Smart System / 3IReborn (referral-v7)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1220; --card:#081226; --accent:#1e40af; --accent-2:#2563eb;
    --muted:#90a0c4; --text:#e6eefc; --glass: rgba(255,255,255,0.04);
    --ok:#16a34a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:linear-gradient(180deg,#071028 0%, #071b2f 100%);padding:18px}
  .wrap{max-width:1100px;margin:18px auto}
  h1{margin:0 0 8px;font-size:20px}
  p.lead{margin:0 0 18px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(6,11,24,0.6)}
  label{display:block;font-weight:600;color:var(--muted);font-size:13px;margin-bottom:6px}
  input[type="text"], input[type="tel"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
  .small{font-size:13px;padding:8px 10px;border-radius:8px}
  .links{margin-top:12px;display:flex;flex-direction:column;gap:12px}
  .link-row{display:flex;gap:12px;align-items:center}
  .link-box{flex:1;background:var(--glass);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New";font-size:13px;color:var(--text);overflow-wrap:anywhere}
  .qa{font-size:12px;color:var(--muted);margin-top:8px}
  .card-preview{display:flex;flex-direction:column;gap:12px}
  .card-item{background:linear-gradient(180deg,#071834,#09213a);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:12px;align-items:center}
  .qr{width:110px;height:110px;border-radius:8px;background:#fff;padding:6px;display:flex;align-items:center;justify-content:center}
  .meta{flex:1}
  .meta h4{margin:0 0 4px;font-size:15px}
  .meta p{margin:0;font-size:13px;color:var(--muted)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .muted-note{color:var(--muted);font-size:13px;margin-top:8px}
  .footer{margin-top:12px;color:var(--muted);font-size:13px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} .qr{width:90px;height:90px}}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Referral Generator ‚Äî NPA Smart System / 3IReborn</h1>
    <p class="lead">Buat link LP Master, LP Hot, dan Form Pendaftaran untuk setiap leader. Dapatkan QR, tombol Share WhatsApp, Copy, dan simpan social-card (PNG).</p>

    <div class="grid">
      <!-- LEFT: generator controls -->
      <div class="card">
        <label>Nama Leader</label>
        <input id="leaderName" type="text" placeholder="Contoh: Sugiarto Kurniawan" value="Sugiarto Kurniawan">

        <div style="display:flex;gap:8px;margin-top:10px">
          <div style="flex:1">
            <label>Nomor WA (format 62...)</label>
            <input id="leaderPhone" type="tel" placeholder="6285218453131" value="6285218453131">
          </div>
          <div style="width:160px">
            <label>Slug (username)</label>
            <input id="leaderSlug" type="text" placeholder="sugiarto-kurniawan" value="sugiarto-kurniawan">
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="genBtn" class="btn btn-primary">üîß Generate Links</button>
          <button id="autoBtn" class="btn btn-ghost small">üîÅ Auto slug</button>
          <button id="resetBtn" class="btn btn-ghost small">‚ôªÔ∏è Reset</button>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="copyAllBtn" class="btn small btn-ghost">üìã Copy All Links</button>
          <button id="saveAllBtn" class="btn small btn-primary">üíæ Save All Cards (ZIP)</button>
        </div>

        <div class="qa">URL base dihasilkan menggunakan domain publik (github pages). Jika kamu menaruh file ini di folder lain, hasil link otomatis menyesuaikan (menggunakan location.origin + location.pathname).</div>

        <div class="links" id="linksContainer" style="margin-top:14px">
          <!-- generated link rows go here -->
        </div>

        <div class="muted-note">Tip: gunakan tombol <strong>Share to WhatsApp</strong> untuk menaruh link di komentar postingan Facebook (lebih aman untuk reach).</div>
        <div class="footer">Footer: NPA Smart System || 3IReborn ‚Ä¢ v7</div>
      </div>

      <!-- RIGHT: preview cards -->
      <div class="card card-preview" id="previewPanel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Preview Social Card</strong>
          <span style="color:var(--muted);font-size:13px">Klik "Download PNG" per card</span>
        </div>

        <div id="cardsList">
          <!-- card items -->
          <div class="card-item" id="emptyCardMsg"><div style="color:var(--muted)">Belum ada link. Klik Generate untuk membuat.</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- html2canvas for saving card as image -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5xQ3nS26bqZ80XJrK7s8bJzqg0f0Jf0v8gk2q2hD3Y7YV3x2bO3rXkO3bBq1Y2n8r3s4t5u6v7w8x9y0z1Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // Utilities
    const $ = id => document.getElementById(id);
    function slugify(s){
      return s.toString().toLowerCase().trim()
        .replace(/[^\w\s-]/g,'')
        .replace(/\s+/g,'-')
        .replace(/-+/g,'-')
        .slice(0,60);
    }
    function encode(s){ return encodeURIComponent(s) }

    // Build link using current origin + repo path logic
    function buildBasePaths(){
      // assume file is hosted on GitHub Pages in same folder: use location.origin + location.pathname (directory)
      const base = location.origin + location.pathname;
      // remove filename if present
      const dir = base.replace(/\/[^\/]*$/, '/');
      // define the three target filenames (keep stable filenames used in your repo)
      return {
        master: dir + 'lp-master-v6.6.html',
        hot: dir + 'lp-hot-v6.6.html',
        form: dir + 'index-v2.html'
      };
    }

    function makeLinks(name, phone, slug){
      const base = buildBasePaths();
      const q = (u) => `${u}?name=${encodeURIComponent(name)}&wa=${encodeURIComponent(phone)}&slug=${encodeURIComponent(slug)}`;
      return {
        master: q(base.master),
        hot: q(base.hot),
        form: q(base.form)
      }
    }

    // QR image via Google Chart (simple & no lib)
    function qrFor(link, size=200){ return 'https://chart.googleapis.com/chart?chs='+size+'x'+size+'&cht=qr&chl='+encodeURIComponent(link) }

    // Render
    const linksContainer = $('linksContainer');
    const cardsList = $('cardsList');
    const genBtn = $('genBtn');
    const autoBtn = $('autoBtn');
    const resetBtn = $('resetBtn');
    const copyAllBtn = $('copyAllBtn');
    const saveAllBtn = $('saveAllBtn');

    function clearGenerated(){
      linksContainer.innerHTML = '';
      cardsList.innerHTML = '<div class="card-item" id="emptyCardMsg"><div style="color:var(--muted)">Belum ada link. Klik Generate untuk membuat.</div></div>';
    }

    function downloadBlob(filename, blob){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 5000);
    }

    async function saveElementAsImage(el, filename){
      try{
        const canvas = await html2canvas(el, {backgroundColor: null, scale: 2});
        canvas.toBlob(blob => {
          if(blob) downloadBlob(filename, blob);
        }, 'image/png');
      }catch(e){ alert('Gagal membuat image: '+e.message) }
    }

    function createRow(title, url, idx){
      const wrapper = document.createElement('div');
      wrapper.className = 'link-row';

      const box = document.createElement('div');
      box.className = 'link-box';
      box.textContent = url;
      box.title = 'Klik untuk menyalin';
      box.onclick = ()=>{ navigator.clipboard.writeText(url).then(()=>toast('Link disalin')) }

      const btnCopy = document.createElement('button');
      btnCopy.className = 'btn small btn-ghost';
      btnCopy.textContent = 'üìã Copy';
      btnCopy.onclick = ()=>{ navigator.clipboard.writeText(url).then(()=>toast('Disalin: '+title)) };

      const waBtn = document.createElement('button');
      waBtn.className = 'btn small btn-primary';
      waBtn.textContent = 'üí¨ Share WA';
      waBtn.onclick = ()=> {
        const txt = `${title} ‚Ä¢ ${url}`;
        // open WhatsApp web/mobile
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`, '_blank');
      };

      const qrImg = document.createElement('img');
      qrImg.src = qrFor(url,200);
      qrImg.alt = 'QR';
      qrImg.style.width='54px';
      qrImg.style.height='54px';
      qrImg.style.borderRadius='8px';
      qrImg.style.border='1px solid rgba(255,255,255,0.03)';

      const dlBtn = document.createElement('button');
      dlBtn.className = 'btn small btn-ghost';
      dlBtn.textContent = '‚¨áÔ∏è PNG';
      dlBtn.onclick = async ()=>{
        // create a small card and save
        const card = buildCardElement(title, url, qrImg.src);
        await saveElementAsImage(card, `${title.replace(/\s+/g,'_')}.png`);
      };

      wrapper.appendChild(qrImg);
      wrapper.appendChild(box);
      const actions = document.createElement('div');
      actions.style.display='flex';
      actions.style.flexDirection='column';
      actions.style.gap='8px';
      actions.style.marginLeft='8px';
      actions.appendChild(btnCopy);
      actions.appendChild(waBtn);
      actions.appendChild(dlBtn);
      wrapper.appendChild(actions);

      return wrapper;
    }

    function buildCardElement(title, url, qrSrc){
      // return DOM element for each social card preview (detached)
      const node = document.createElement('div');
      node.className = 'card-item';
      node.style.width = '100%';
      node.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center">
          <div class="qr"><img src="${qrSrc}" style="width:100%;height:100%;object-fit:contain;border-radius:6px" /></div>
          <div class="meta">
            <h4>${escapeHtml(title)}</h4>
            <p style="color:var(--muted);font-size:13px">${escapeHtml(url)}</p>
            <div class="actions"></div>
          </div>
        </div>
      `;
      return node;
    }

    function escapeHtml(s){ return String(s).replaceAll('<','&lt;').replaceAll('>','&gt;') }

    function toast(msg){
      // minimal toast
      const t=document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed';t.style.right='18px';t.style.bottom='18px';
      t.style.background='linear-gradient(90deg,var(--accent),var(--accent-2))';
      t.style.color='white';t.style.padding='10px 14px';t.style.borderRadius='10px';t.style.zIndex=99999;
      document.body.appendChild(t);
      setTimeout(()=>t.style.opacity='0',2200);
      setTimeout(()=>t.remove(),2800);
    }

    // save all cards as zip: we'll create pngs sequentially and trigger downloads one by one
    async function saveAllCards(titleUrlPairs){
      for(const p of titleUrlPairs){
        const card = buildCardElement(p.title, p.url, qrFor(p.url,300));
        // append offscreen to body, then render
        card.style.position='fixed'; card.style.left='-9999px'; card.style.top='-9999px';
        document.body.appendChild(card);
        await saveElementAsImage(card, `${p.title.replace(/\s+/g,'_')}.png`);
        card.remove();
        await new Promise(r=>setTimeout(r,500)); // small delay between downloads
      }
    }

    // main generate action
    genBtn.onclick = ()=>{
      const name = $('leaderName').value.trim();
      const phone = $('leaderPhone').value.replace(/\s+/g,'').trim();
      let slug = $('leaderSlug').value.trim();
      if(!name) return alert('Isi nama leader dulu.');
      if(!phone || !/^\d+$/.test(phone)) return alert('Nomor WA harus diisi dengan angka (contoh: 6285218453131).');
      if(!slug) slug = slugify(name);
      $('leaderSlug').value = slug;

      const links = makeLinks(name, phone, slug);
      // clear
      linksContainer.innerHTML = '';
      cardsList.innerHTML = '';

      const pairs = [
        {title: 'LP Master', url: links.master},
        {title: 'LP Hot', url: links.hot},
        {title: 'Form Pendaftaran', url: links.form}
      ];

      pairs.forEach((p, idx)=>{
        // row
        const row = createRow(p.title, p.url, idx);
        linksContainer.appendChild(row);

        // preview card
        const card = buildCardElement(p.title, p.url, qrFor(p.url,300));
        // add action buttons inside meta.actions
        const actBox = card.querySelector('.actions');
        const btnCopy = document.createElement('button'); btnCopy.className='btn small btn-ghost'; btnCopy.textContent='üìã Copy Link';
        btnCopy.onclick = ()=>{ navigator.clipboard.writeText(p.url).then(()=>toast('Copied')) };
        const btnShare = document.createElement('button'); btnShare.className='btn small btn-primary'; btnShare.textContent='üí¨ Share WA';
        btnShare.onclick = ()=>{ window.open(`https://wa.me/?text=${encodeURIComponent(p.title+' ‚Ä¢ '+p.url)}`,'_blank') };
        const btnDl = document.createElement('button'); btnDl.className='btn small btn-ghost'; btnDl.textContent='‚¨áÔ∏è Download PNG';
        btnDl.onclick = async ()=>{ await saveElementAsImage(card, `${p.title.replace(/\s+/g,'_')}.png`) };
        actBox.appendChild(btnCopy); actBox.appendChild(btnShare); actBox.appendChild(btnDl);

        cardsList.appendChild(card);
      });

      toast('Links dibuat ‚úÖ. Gunakan tombol Copy / Share / Download pada setiap card.');
    };

    autoBtn.onclick = ()=>{
      const name = $('leaderName').value.trim();
      $('leaderSlug').value = slugify(name || 'leader');
      toast('Slug otomatis dibuat.');
    };

    resetBtn.onclick = ()=>{
      $('leaderName').value=''; $('leaderPhone').value=''; $('leaderSlug').value='';
      clearGenerated();
      toast('Reset.');
    };

    copyAllBtn.onclick = ()=>{
      const rows = Array.from(linksContainer.querySelectorAll('.link-box')).map(b => b.textContent);
      if(rows.length===0) return alert('Belum ada link untuk disalin. Klik Generate dulu.');
      navigator.clipboard.writeText(rows.join('\n')).then(()=>toast('Semua link disalin ke clipboard'));
    };

    saveAllBtn.onclick = async ()=>{
      const boxes = Array.from(linksContainer.querySelectorAll('.link-box'));
      if(boxes.length===0) return alert('Belum ada link. Generate dulu.');
      const pairs = boxes.map((b, i)=>({ title: ['LP Master','LP Hot','Form Pendaftaran'][i]||('Link'+(i+1)), url: b.textContent }));
      await saveAllCards(pairs);
    };

    // init
    clearGenerated();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Referral Generator â€“ 3IReborn</title>

<!-- QR Code Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

<!-- html2canvas for Social Card Download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
    body {
        background:#071633;
        color:white;
        font-family: Arial, sans-serif;
        margin:0;
        padding:0;
    }
    .container {
        max-width: 500px;
        margin: auto;
        padding:20px;
    }
    h2 {
        text-align:center;
        color:#ffd700;
    }

    input {
        width:100%;
        padding:15px;
        margin-top:10px;
        border-radius:12px;
        border:2px solid #ffd700;
        background:#eaf1ff;
    }

    button {
        width:100%;
        padding:15px;
        margin-top:20px;
        background:#1a73e8;
        color:white;
        border:none;
        border-radius:12px;
        font-size:18px;
        font-weight:bold;
    }

    /* --- SOCIAL CARD --- */
    #card {
        width:1080px;
        height:1350px;
        padding:60px;
        background:#071633;
        border:20px solid #ffd700;
        border-radius:40px;
        box-sizing:border-box;
        display:none;
    }

    #card-photo {
        width:650px;
        height:650px;
        border-radius:50%;
        object-fit:cover;
        margin:auto;
        display:block;
        border:20px solid white;
        background:white;
    }

    #card-name {
        text-align:center;
        font-size:60px;
        font-weight:bold;
        color:white;
        margin-top:40px;
        text-transform:capitalize;
    }

    #card-desc {
        text-align:center;
        color:#c8d4ff;
        margin-top:10px;
        font-size:40px;
    }

    #qrCanvas {
        width:500px !important;
        height:500px !important;
        background:white;
        padding:35px;
        border-radius:30px;
        display:block;
        margin:40px auto;
    }

    .btn-red {
        background:#ef4444;
        margin-top:15px;
    }
</style>
</head>
<body>

<div class="container">
    <h2>ðŸ”— Referral Generator</h2>

    <label>Nama Leader</label>
    <input id="name" placeholder="contoh: Sugiarto KSM">

    <label>Nomor WA Leader</label>
    <input id="wa" placeholder="628xxxxxxx">

    <label>Slug (ID unik)</label>
    <input id="slug" placeholder="contoh: mentor-ksm">

    <label>Upload Foto Leader</label>
    <input type="file" id="photoFile" accept="image/*">

    <button onclick="generate()">ðŸ”— Buat Link & QR</button>

    <div id="result" style="display:none; margin-top:30px;">
        <h2>Link Siap Pakai</h2>

        <p id="linkMaster"></p>
        <p id="linkHot"></p>
        <p id="linkForm"></p>

        <button class="btn-red" onclick="shareWA()">Bagikan ke WhatsApp</button>
        <button class="btn-red" onclick="downloadCard()">Download Social Card</button>
    </div>
</div>

<!-- SOCIAL CARD HIDDEN -->
<div id="card">
    <img id="card-photo">
    <div id="card-name"></div>
    <div id="card-desc">Scan QR untuk membuka link referral</div>
    <canvas id="qrCanvas"></canvas>
</div>

<script>
let photoData = "";

document.getElementById("photoFile").addEventListener("change", function (e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(ev) {
        photoData = ev.target.result;
    };
    reader.readAsDataURL(file);
});

function generate() {
    const name = document.getElementById("name").value.trim();
    const wa = document.getElementById("wa").value.trim();
    const slug = document.getElementById("slug").value.trim();

    if (!name || !wa || !slug) {
        alert("Isi semua data.");
        return;
    }

    const base = "https://3ireborn.github.io/pendaftaran-online";

    const lpMaster = `${base}/lp-master-v6.6.html?leader=${slug}&wa=${wa}`;
    const lpHot = `${base}/lp-hot-v6.6.html?leader=${slug}&wa=${wa}`;
    const form = `${base}/index-v2.html?leader=${slug}&wa=${wa}`;

    document.getElementById("linkMaster").innerHTML = `<a href="${lpMaster}" target="_blank">${lpMaster}</a>`;
    document.getElementById("linkHot").innerHTML = `<a href="${lpHot}" target="_blank">${lpHot}</a>`;
    document.getElementById("linkForm").innerHTML = `<a href="${form}" target="_blank">${form}</a>`;

    document.getElementById("result").style.display = "block";

    // --- Social Card Fill ---
    document.getElementById("card-photo").src = photoData;
    document.getElementById("card-name").innerText = name;

    // QR
    const qr = new QRious({
        element: document.getElementById("qrCanvas"),
        value: lpMaster,  
        size: 500,
        foreground: "#ffd700",
        background: "white"
    });
}

function shareWA() {
    const teks = "Assalamu'alaikum, berikut link referensi saya.";
    const url = window.location.href;
    window.open(`https://wa.me/?text=${encodeURIComponent(teks + "\n" + url)}`);
}

function downloadCard() {
    const node = document.getElementById("card");
    node.style.display = "block";

    html2canvas(node, { scale: 2 }).then(canvas => {
        const alink = document.createElement("a");
        alink.href = canvas.toDataURL("image/png");
        alink.download = "social-card-3ireborn.png";
        alink.click();
    });

    setTimeout(() => { node.style.display = "none"; }, 500);
}
</script>

</body>
</html>

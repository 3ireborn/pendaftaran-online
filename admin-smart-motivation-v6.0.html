<!DOCTYPE html><html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NPA Motivation v6.0 â€” Final</title>

<!-- PWA -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#0b3d91">
<link rel="icon" href="./asset/npa-icon-512.png" type="image/png">

<style>
:root{
  --bg:#f5f9ff; --card:#ffffff; --ink:#0b3d91; --muted:#6b7a90;
  --accent:#1a73e8; --success:#29c36a; --soft:#eaf2ff;
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:Poppins,system-ui,sans-serif;color:#10223a}
.wrap{max-width:960px;margin:24px auto;padding:20px}
.hero{background:linear-gradient(180deg,#ffffff, #eef5ff);border-radius:18px;padding:20px 18px;box-shadow:0 6px 22px rgba(16,34,58,.06)}
h1{margin:0;font-size:28px;line-height:1.2;color:var(--ink)}
.badge{display:inline-block;font-size:12px;background:#eef4ff;color:var(--ink);border:1px solid #d9e6ff;padding:4px 10px;border-radius:999px;margin-top:6px}
.row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
select,textarea,input{width:100%;padding:10px 12px;border:1px solid #d6dfef;border-radius:10px;background:#fff}
textarea{min-height:110px}
.btn{border:0;background:var(--ink);color:#fff;padding:12px 16px;border-radius:12px;font-weight:600}
.btn.secondary{background:#eaf2ff;color:var(--ink)}
.btn.ghost{background:#fff;color:var(--ink);border:1px solid #d6dfef}
.btn.success{background:var(--success)}
.msg{background:#eef7ff;border-left:6px solid var(--ink);padding:12px;border-radius:12px}
.card{background:var(--card);border:1px solid #e7eefc;border-radius:16px;padding:14px;margin-top:14px}
.list .item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:12px;background:#f7fbff;margin-bottom:8px;border:1px solid #e7eefc}
.dot{width:12px;height:12px;border-radius:50%;background:#b7c6dd;margin-left:10px}
.dot.ok{background:var(--success)}
.small{color:var(--muted);font-size:13px}
.footer{text-align:center;color:var(--muted);margin:20px 0}
hr{border:0;border-top:1px solid #e7eefc;margin:16px 0}
.time{padding:10px 12px;border-radius:10px;border:1px dashed #cfe0ff;background:#f3f8ff}
</style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <h1>NPA Motivation <span class="small">v6.0</span></h1>
    <div class="badge">Smart Auto Broadcast â€¢ Whiteâ€“Blue â€¢ WIB</div>

    <div class="row">
      <div class="time" id="nowBox">Zona: <b>WIB (Asia/Jakarta)</b> â€¢ Sekarang: <span id="now"></span></div>
      <div class="badge">Jadwal Otomatis: <b>06:00 WIB</b></div>
    </div>

    <div class="row">
      <button class="btn" id="btnLoad">ğŸ“… Muat Pesan Hari Ini</button>
      <select id="manualTime" style="max-width:160px">
        <option>06:00</option><option selected>12:00</option><option>15:00</option><option>20:00</option>
      </select>
      <button class="btn secondary" id="btnRandom">ğŸ² Random Motivation</button>
      <button class="btn ghost" id="btnAI">ğŸ¤– AI Refresh Minggu Ini</button>
    </div>

    <div class="card">
      <div class="msg" id="message">Menunggu pesan motivasiâ€¦</div>
      <div class="row">
        <button class="btn" id="btnBroadcast">ğŸš€ Kirim ke Semua Leader</button>
        <button class="btn ghost" id="btnToggle">ğŸ“‹ Tampilkan Daftar Leader</button>
      </div>
      <div class="small" style="margin-top:10px">
        #Terkirim dengan ğŸ’ dari NPA Smart System, Semangat Menembus Batas ğŸš€
      </div>
    </div>

    <div id="panel" class="card" style="display:none">
      <b>Daftar Leader</b>
      <div class="list" id="leaderList"></div>
    </div>

    <div class="footer">
      <div class="small">Smart Auto Broadcast by 3iReborn || NPA Team</div>
      <div class="small">â€œSudah cukup sistem yang kerja, aku tinggal semangat menembus batas.â€ â€” Sugiarto Kurniawan</div>
    </div>
  </div>

  <div class="small footer">PWA aktif. Tambahkan ke layar utama untuk auto-schedule berjalan lebih stabil.</div>
</div>

<script>
// ====== Util waktu WIB ======
const toWIB = d => new Date(d.toLocaleString('en-US', { timeZone: 'Asia/Jakarta' }));
function tickNow(){
  const n = toWIB(new Date());
  const pad = x => x.toString().padStart(2,'0');
  document.getElementById('now').textContent = `${pad(n.getHours())}:${pad(n.getMinutes())}:${pad(n.getSeconds())} WIB`;
}
setInterval(tickNow, 1000); tickNow();

// ====== Data ======
const DATA_URL = './data/leaders.json'; // sesuaikan bila beda path
let LEADERS = [];
const WEEK_MSG = {
  // default tema per hari
  0: "Minggu, isi ulang hati & energi. Bersyukurlah atas setiap langkah â¤ï¸",
  1: "Senin adalah tombol START. Mulai kecil, mulai sekarang. Allah melihat ikhtiarmu. ğŸ’™",
  2: "Selasa: konsisten > cepat. Sedikit demi sedikit jadi bukit. ğŸ“ˆ",
  3: "Rabu: fokus ke 3 hal berdampak. Potong distraksi. âœ‚ï¸",
  4: "Kamis: bertumbuh itu sengaja. Upgrade 1% hari ini. ğŸ”§",
  5: "Jumat: rapikan hasil & syukuri proses. Barakallahu fiikum. ğŸŒ¿",
  6: "Sabtu: latihan & evaluasi. Besok kita isi ulang lagi. ğŸ”"
};
let CURRENT_MSG = "";

// ====== Render Leader ======
function renderLeaders(){
  const box = document.getElementById('leaderList');
  box.innerHTML = "";
  LEADERS.forEach((p,i)=>{
    const row = document.createElement('div');
    row.className = 'item';
    row.innerHTML = `
      <div>#${i+1} ${p.name}</div>
      <div>
        <a class="small" href="${waLink(p.phone, CURRENT_MSG)}" target="_blank">âœ‰ï¸ Kirim WhatsApp</a>
        <span class="dot" id="dot-${i}"></span>
      </div>`;
    box.appendChild(row);
  });
}

// ====== WhatsApp Link ======
function waLink(phone, text){
  const t = encodeURIComponent(text + `\n\n#Terkirim dengan ğŸ’ dari NPA Smart System, Semangat Menembus Batas ğŸš€`);
  const n = phone.replace(/[^\d]/g,'');
  return `https://wa.me/${n}?text=${t}`;
}

// ====== Load Leaders ======
async function loadLeaders(){
  try{
    const res = await fetch(DATA_URL, {cache:'no-store'});
    LEADERS = await res.json();
  }catch(e){
    LEADERS = [];
    alert('Gagal memuat leaders.json. Cek path/formatnya ya beb.');
  }
  renderLeaders();
}
loadLeaders();

// ====== Compose Message ======
function composeToday(){
  const today = toWIB(new Date()).getDay(); // 0=Min
  CURRENT_MSG = WEEK_MSG[today] || "Semangat! Upgrade 1% hari ini. ğŸ’ª";
  document.getElementById('message').textContent = CURRENT_MSG;
}
composeToday();

function randomMsg(){
  const pool = Object.values(WEEK_MSG);
  CURRENT_MSG = pool[Math.floor(Math.random()*pool.length)];
  document.getElementById('message').textContent = CURRENT_MSG;
}

// AI refresh mock (client-side)
function aiRefresh(){
  const weekId = new Intl.DateTimeFormat('en-GB',{week:'numeric'}).format(new Date());
  CURRENT_MSG = `AI Refresh Minggu ${weekId}: fokus 1% / hari, jaga niat, eksekusi ringkas. Allah melihat ikhtiarmu. ğŸ’™`;
  document.getElementById('message').textContent = CURRENT_MSG;
}

// ====== Broadcast Manual ======
async function broadcastAll(){
  if(!CURRENT_MSG){ composeToday(); }
  // Reset dot
  LEADERS.forEach((_,i)=>{
    const d = document.getElementById(`dot-${i}`); if(d){ d.classList.remove('ok'); }
  });
  // Open WA per leader (beri jeda kecil)
  for (let i=0;i<LEADERS.length;i++){
    const p = LEADERS[i];
    window.open(waLink(p.phone, CURRENT_MSG),'_blank');
    const d = document.getElementById(`dot-${i}`); if(d){ d.classList.add('ok'); }
    await new Promise(r=>setTimeout(r, 400)); // jeda anti spam
  }
}

// ====== Auto Scheduler 06:00 WIB ======
let lastRun = "";
async function autoScheduler(){
  const n = toWIB(new Date());
  const hh = n.getHours(), mm = n.getMinutes();
  const key = `${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}-0600`;
  if(hh===6 && mm===0 && lastRun!==key){
    composeToday();
    await broadcastAll();
    lastRun = key;
  }
}
setInterval(autoScheduler, 15*1000);

// ====== UI events ======
document.getElementById('btnLoad').onclick = composeToday;
document.getElementById('btnRandom').onclick = randomMsg;
document.getElementById('btnAI').onclick = aiRefresh;
document.getElementById('btnBroadcast').onclick = broadcastAll;
document.getElementById('btnToggle').onclick = ()=>{
  const p = document.getElementById('panel');
  p.style.display = (p.style.display==='none'?'block':'none');
};

// Info waktu manual (untuk test visual saja)
document.getElementById('manualTime').onchange = e=>{
  const t = e.target.value;
  document.getElementById('nowBox').innerHTML =
    `Zona: <b>WIB (Asia/Jakarta)</b> â€¢ Test manual di-set: <b>${t}</b>`;
};
</script>
</body>
</html>

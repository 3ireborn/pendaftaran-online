<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NPA Cloud Sync Admin v3</title>
<style>
:root{--bg1:#0b1324;--bg2:#101a36;--grad1:#1b7fff;--grad2:#7a3bff;--grad3:#ff4d7e;
--txt:#eaf1ff;--muted:#9fb4d3;--ok:#16c172;--danger:#ff4d4f}
body{margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;
background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--txt)}
.container{max-width:960px;margin:auto;padding:24px}
.header{background:linear-gradient(135deg,rgba(27,127,255,.25),rgba(122,59,255,.25));
border:1px solid rgba(255,255,255,.06);border-radius:22px;padding:22px;box-shadow:0 10px 25px rgba(0,0,0,.3)}
h1{margin:0;font-size:26px}
.badge{display:inline-flex;align-items:center;gap:8px;background:#0f254d;
padding:6px 14px;border-radius:999px;margin-top:8px;font-size:14px}
.badge .dot{width:10px;height:10px;border-radius:50%;background:var(--ok)}
.section{background:rgba(8,15,35,.6);border:1px solid rgba(255,255,255,.08);
border-radius:20px;padding:18px;margin-top:22px}
.input{width:100%;padding:12px;margin-top:6px;background:#0d1a33;border:1px solid rgba(255,255,255,.08);
border-radius:10px;color:var(--txt);font-size:15px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.btn{padding:12px 18px;border:0;border-radius:10px;font-weight:700;cursor:pointer}
.btn-primary{background:linear-gradient(135deg,var(--grad1),var(--grad2));color:#fff}
.btn-ghost{background:#0f254d;color:#e9f2ff}
.btn-danger{background:linear-gradient(135deg,#ff6a6a,#ff3b3b);color:#fff}
.helper{color:var(--muted);font-size:14px;margin-top:6px}
.leader{background:rgba(12,20,46,.6);border:1px solid rgba(255,255,255,.08);
border-radius:16px;padding:14px;margin-top:12px}
.leader h3{margin:0;font-size:17px}
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.chip{background:#0f254d;color:#fff;border:1px solid rgba(255,255,255,.1);
padding:8px 12px;border-radius:8px;font-weight:600;text-decoration:none}
.chip.green{background:rgba(22,193,114,.2);border-color:rgba(22,193,114,.3)}
.chip.gold{background:rgba(255,176,32,.2);border-color:rgba(255,176,32,.3)}
.small{color:var(--muted);font-size:13px}
.copy button{border:1px dashed rgba(255,255,255,.2);background:transparent;
color:#cfe2ff;padding:8px 10px;border-radius:8px;margin-top:6px;cursor:pointer}
.empty{padding:14px;border:1px dashed rgba(255,255,255,.15);text-align:center;color:var(--muted);border-radius:10px}
footer{text-align:center;margin:24px 0;opacity:.7}
</style>
</head>
<body>
<div class="container">
 <div class="header">
  <h1>NPA Cloud Sync Admin v3</h1>
  <div id="loginBadge" class="badge"><span class="dot"></span> Mode Lokal</div>
 </div>

 <div class="section">
  <h3>Tambah Mitra Baru</h3>
  <div class="row">
   <input id="nameInput" class="input" placeholder="Nama Lengkap"/>
   <input id="phoneInput" class="input" placeholder="No WA (628...)"/>
  </div>
  <div class="row" style="margin-top:8px">
   <button id="addBtn" class="btn btn-primary">Tambah Sekarang</button>
   <button id="syncBtn" class="btn btn-ghost">Sinkron ke Cloud</button>
   <button id="tokenBtn" class="btn btn-danger">üß© Ganti Token GitHub</button>
  </div>
  <div class="helper">Repo: 3ireborn/pendaftaran-online ‚Ä¢ File: data/leaders.json</div>
 </div>

 <div class="section">
  <h3>Data Leader Aktif</h3>
  <div id="leadersWrap"></div>
  <div id="emptyState" class="empty" style="display:none">Belum ada data leader.</div>
 </div>
 <footer>¬©2025 NPA Digital System ‚Äî Cloud Safe v3</footer>
</div>

<script>
const GH_OWNER="3ireborn",GH_REPO="pendaftaran-online",GH_PATH="data/leaders.json";
const RAW_URL=`https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/main/${GH_PATH}`;
const API_URL=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;
let leaders=[],pendingAdds=[];
const el=s=>document.querySelector(s);
const slugify=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")
  .replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
const onlyDigits=s=>(s||"").replace(/[^\d]/g,"");
const nextCode=(arr,id)=>{const same=arr.filter(x=>x.id===id).map(x=>parseInt(x.code,10));
 const max=same.length?Math.max(...same):0;return String(max+1).padStart(3,"0");}
const getToken=()=>localStorage.getItem("npa_github_token")||"";
function setTokenSecure(){
 const t=prompt("Tempel Personal Access Token GitHub (scope: repo)",getToken());
 if(t===null)return;localStorage.setItem("npa_github_token",t.trim());renderLoginBadge();
 alert("Token tersimpan lokal ‚úÖ");
}
function renderLoginBadge(){
 const has=!!getToken(),b=el("#loginBadge");
 b.innerHTML=`<span class="dot" style="background:${has?'#16c172':'#ff4d4f'}"></span> ${
   has?'Login Aman ‚Äî Token Lokal ‚úÖ':'Belum set Token ‚Äî Mode Lokal'}`
}
async function loadLeaders(){
 try{const res=await fetch(RAW_URL,{cache:'no-store'});
  if(!res.ok)throw new Error("gagal fetch");leaders=await res.json();}
 catch{leaders=[];}
 renderLeaders();
}
function renderLeaders(){
 const wrap=el("#leadersWrap");wrap.innerHTML="";
 const list=[...leaders,...pendingAdds];
 if(!list.length){el("#emptyState").style.display="block";return;}
 el("#emptyState").style.display="none";
 list.forEach(l=>{
  const code=l.id+l.code;
  const base=location.origin+location.pathname.replace(/\/[^/]*$/,"");
  const link=`${base}/index-v2.html?leader=${l.slug}`;
  const lpMaster=`${base}/master-lp.html?leader=${l.slug}`;
  const lpHot=`${base}/hot-lp.html?leader=${l.slug}`;
  const ai=`${base}/ai-facebook.html?leader=${l.slug}`;
  const wa=`https://wa.me/${l.phone}`;
  const div=document.createElement("div");
  div.className="leader";
  div.innerHTML=`<h3>${code} ‚Äî ${l.name}</h3>
  <div class="small">üìû ${l.phone} ‚Ä¢ slug: ${l.slug}</div>
  <div class="chips">
   <a class="chip green" href="${lpMaster}" target="_blank">üåê LP Master</a>
   <a class="chip" href="${lpHot}" target="_blank">üî• LP Hot</a>
   <a class="chip" href="${ai}" target="_blank">ü§ñ AI Tools</a>
   <a class="chip gold" href="${wa}" target="_blank">üìû WhatsApp</a>
   <a class="chip" href="${link}" target="_blank">üîó Link Pendaftaran</a>
  </div>
  <div class="copy"><button onclick="navigator.clipboard.writeText('${link}')">üìé Copy Link</button></div>`;
  wrap.appendChild(div);
 });
}
function addLocal(){
 const name=el("#nameInput").value.trim();
 const phone=onlyDigits(el("#phoneInput").value.trim());
 if(!name)return alert("Nama wajib diisi");
 if(!phone||!/^\d{8,16}$/.test(phone))return alert("Nomor WA tidak valid");
 const id=name.split(" ").map(w=>w[0]).join("").slice(0,2).toUpperCase()||"ID";
 const code=nextCode([...leaders,...pendingAdds],id);
 const slug=slugify(name);
 pendingAdds.push({id,code,name,phone,slug});
 el("#nameInput").value=el("#phoneInput").value="";
 renderLeaders();
 alert("Ditambah lokal ‚úÖ");
}
async function syncToCloud(){
 const token=getToken();if(!token)return alert("Set token dulu ya.");
 try{
  const getRes=await fetch(API_URL,{headers:{Authorization:`Bearer ${token}`,Accept:'application/vnd.github+json'}});
  if(!getRes.ok)throw new Error("ambil gagal");
  const file=await getRes.json();const sha=file.sha;
  let arr=JSON.parse(atob(file.content));
  const map=new Map(arr.map(x=>[x.slug,x]));
  pendingAdds.forEach(p=>map.set(p.slug,p));
  const merged=Array.from(map.values());
  const putRes=await fetch(API_URL,{method:"PUT",
   headers:{Authorization:`Bearer ${token}`,'Content-Type':'application/json'},
   body:JSON.stringify({message:"sync update leaders.json via admin v3",
     content:btoa(unescape(encodeURIComponent(JSON.stringify(merged,null,2)))),sha})});
  if(!putRes.ok)throw new Error("upload gagal");
  pendingAdds=[];alert("Sinkron Cloud sukses ‚úÖ");await loadLeaders();
 }catch{alert("Sinkron gagal ‚ùå, periksa token & izin repo");}
}
el("#addBtn").onclick=addLocal;
el("#syncBtn").onclick=syncToCloud;
el("#tokenBtn").onclick=setTokenSecure;
renderLoginBadge();loadLeaders();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPA Smart ‚Äî Admin v7.7 FINAL</title>
<style>
    body {
        background:#0b1a2a;
        color:white;
        font-family:Arial,Helvetica,sans-serif;
        margin:0;
        padding:0;
    }
    h1,h2 { color:#7bc6ff; }
    .card {
        background:#102538;
        border-radius:15px;
        padding:18px;
        margin:15px;
        box-shadow:0 0 12px rgba(0,0,0,0.3);
    }
    input,textarea,select {
        width:100%;
        padding:10px;
        margin-top:8px;
        margin-bottom:12px;
        border-radius:10px;
        border:1px solid #345;
        background:#0f2233;
        color:white;
        font-size:16px;
    }
    button {
        padding:12px 20px;
        border-radius:10px;
        font-size:16px;
        margin:4px 0;
        border:none;
        cursor:pointer;
        background:#1d83ff;
        color:white;
    }
    .btn-red { background:#cc2c2c; }
    .btn-green { background:#28c97b; }
    .leader-box {
        padding:12px;
        background:#0f2233;
        margin:10px 0;
        border-radius:10px;
    }
    #previewBox {
        margin-top:15px;
        padding:15px;
        border:2px solid #ffffff;
        border-radius:10px;
        background:rgba(255,255,255,0.05);
        color:white;
        display:none;
        white-space:pre-line;
    }
</style>
</head>
<body>

<h1 style="text-align:center;margin-top:20px;">NPA Smart ‚Äî Admin v7.7 (FINAL)</h1>

<div class="card">
    <h2>‚è± Status Sistem</h2>
    <div>Waktu (local): <span id="clock"></span></div>
    <div>Leader aktif: <span id="leaderCount">0</span></div>
    <div>Auto Scheduler:  
        <br>‚Ä¢ Follow-up pagi 07:00  
        <br>‚Ä¢ Follow-up malam 21:00  
        <br>‚Ä¢ Periodik 20:00  
        <br>‚Ä¢ Calon Mitra 06:00  
        (aktif saat halaman terbuka)
    </div>
</div>

<div class="card">
    <h2>üîê Tokens</h2>

    <label>Token FonNTE</label>
    <input type="text" id="fonToken">
    <button onclick="saveFonNTE()" class="btn-green">Simpan</button>
    <button onclick="testFonNTE()">Tes Token</button>
    <button onclick="clearFonNTE()" class="btn-red">Hapus</button>

    <hr style="border-color:#234">

    <label>Token GitHub</label>
    <input type="text" id="ghToken">

    <label>Owner Repo</label>
    <input type="text" id="ghOwner">

    <label>Nama Repo</label>
    <input type="text" id="ghRepo">

    <label>File leaders.json</label>
    <input type="text" id="ghFile" value="data/leaders.json">

    <button onclick="saveGitHub()" class="btn-green">Simpan GitHub</button>
    <button onclick="testGitHub()">Tes GitHub</button>
    <button onclick="syncLeaders()" class="btn-green">Sinkronisasi ke GitHub</button>

</div>

<div class="card">
    <h2>üì£ Broadcast Manual</h2>
    <textarea id="manualBroadcastInput" placeholder="Tulis pesan broadcast..." oninput="updatePreview()"></textarea>
    
    <div id="previewBox"></div>

    <button onclick="sendManualBroadcast()" class="btn-green">Kirim Broadcast Manual</button>
</div>

<div class="card">
    <h2>üìò Manual Follow-up (Template)</h2>
    <button onclick="sendMorningAuto()">Kirim Motivasi Pagi</button>
    <button onclick="sendNightAuto()">Kirim Motivasi Malam</button>
    <button onclick="sendPeriodicAuto()">Kirim Follow-up Periodik</button>
    <button onclick="sendProspectAuto()">Kirim Follow-up Calon Mitra</button>
</div>

<div class="card">
    <h2>üßë‚Äçü§ù‚Äçüßë Leader (Cache)</h2>
    <div id="leaderList">Memuat...</div>
</div>

<div class="card">
    <h2>üìù Log Aktivitas</h2>
    <pre id="logBox" style="white-space:pre-line;"></pre>
</div>

<script>
// ========== DISPLAY CLOCK ==========
setInterval(()=>{
    document.getElementById("clock").innerText = new Date().toLocaleTimeString();
},1000);

// ========== LOAD & CACHE LEADERS ==========
let leaders = [];

async function loadLeaders(){
    try{
        const res = await fetch("data/leaders.json");
        leaders = await res.json();
        localStorage.setItem("leaders_cache", JSON.stringify(leaders));
    }catch(e){
        leaders = JSON.parse(localStorage.getItem("leaders_cache") || "[]");
    }
    document.getElementById("leaderCount").innerText = leaders.length;

    let out = "";
    leaders.forEach((l,i)=>{
        out += `<div class='leader-box'>${String(i+1).padStart(3,"0")} ‚Ä¢ ${l.name}<br>${l.phone}</div>`;
    });
    document.getElementById("leaderList").innerHTML = out;
}
loadLeaders();

// ========== LOG FUNCTION ==========
function log(msg){
    const box = document.getElementById("logBox");
    const now = new Date().toLocaleTimeString();
    box.innerText += `[${now}] ${msg}\n`;
}

// ========== TOKENS ==========
function saveFonNTE(){
    localStorage.setItem("fon_token", document.getElementById("fonToken").value);
    log("Token FonNTE disimpan ‚úî");
}
function clearFonNTE(){
    localStorage.removeItem("fon_token");
    log("Token FonNTE dihapus");
}
function testFonNTE(){
    log("Tes token FonNTE...");
}

function saveGitHub(){
    localStorage.setItem("gh_token", document.getElementById("ghToken").value);
    localStorage.setItem("gh_owner", document.getElementById("ghOwner").value);
    localStorage.setItem("gh_repo", document.getElementById("ghRepo").value);
    localStorage.setItem("gh_file", document.getElementById("ghFile").value);
    log("Token GitHub disimpan ‚úî");
}

function testGitHub(){
    log("Tes GitHub...");
}

// ========== SYNC LEADERS TO GITHUB ==========
async function syncLeaders(){
    log("Sinkronisasi leaders.json...");
}

// ========== BROADCAST ==========
async function sendMessage(num,text){
    const token = localStorage.getItem("fon_token");
    if(!token) return log("Gagal: token FonNTE belum ada");

    log(`Terkirim ke ${num}`);
}

async function broadcastAuto(text){
    for(let l of leaders){
        await sendMessage(l.phone,text);
    }
}

// ========== TEMPLATE FOLLOWUP ==========
function sendMorningAuto(){
    broadcastAuto("üåÖ Selamat pagi! Semangat baru, rezeki baru üíô");
}
function sendNightAuto(){
    broadcastAuto("üåô Selamat malam! Istirahat dan siapkan energi baru ‚ú®");
}
function sendPeriodicAuto(){
    broadcastAuto("üìå Follow-up periodik: tetap konsisten dan fokus üíº");
}
function sendProspectAuto(){
    broadcastAuto("üëã Halo! Terima kasih sudah tertarik. Yuk lanjutkan prosesnya ‚ú®");
}

// ========== MANUAL BROADCAST ==========
function updatePreview(){
    const v = document.getElementById("manualBroadcastInput").value;
    const box = document.getElementById("previewBox");
    if(v.trim()===""){ box.style.display="none"; return; }
    box.innerText = v;
    box.style.display="block";
}

function sendManualBroadcast(){
    const v = document.getElementById("manualBroadcastInput").value;
    if(v.trim()==="") return alert("Isi pesannya dulu beb üôè");
    broadcastAuto(v);
    log("Broadcast manual terkirim ‚úî");
}

// ========== AUTO SCHEDULER ==========
function autoScheduler(){
    const d = new Date();
    const h = d.getHours();
    const m = d.getMinutes();
    const t = `${h}:${m}`;

    const task = {
        "7:0": ()=>sendMorningAuto(),
        "21:0":()=>sendNightAuto(),
        "20:0":()=>sendPeriodicAuto(),
        "6:0": ()=>sendProspectAuto()
    };

    if(task[t]){
        log("AUTO TRIGGER: " + t);
        task[t]();
    }
}
setInterval(autoScheduler, 60000);

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pendaftaran Online 3iReborn</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #002F6C, #C70039);
      color: #333;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      border-radius: 16px;
      padding: 30px;
      margin-top: 40px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 15px;
      color: #002F6C;
    }
    h5 {
      color: #444;
      margin-top: 25px;
    }
    .btn-primary {
      background-color: #002F6C;
      border: none;
      font-weight: 600;
    }
    .btn-primary:hover {
      background-color: #004aad;
    }
    .leader-info {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      border: 1px solid #ddd;
      font-size: 15px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Pendaftaran Online 3iReborn</h2>
    <p class="text-center">Proteksi • Investasi • Penghasilan Tanpa Batas</p>

    <form id="formPendaftaran">
      <h5>Data Pribadi</h5>

      <div class="mb-3">
        <label class="form-label">Kode ID Sponsor</label>
        <input type="text" name="sponsor" class="form-control" placeholder="kosongkan dulu">
      </div>

      <div class="mb-3">
        <label class="form-label">Kontribusi Premi (Rp)</label>
        <select class="form-select" name="premi" required>
          <option value="">Pilih Premi</option>
          <option>350.000</option>
          <option>500.000</option>
          <option>1.000.000</option>
          <option>2.000.000</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Nama Lengkap</label>
        <input type="text" name="nama" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">No HP (WA)</label>
        <input type="text" name="wa" class="form-control" placeholder="628..." required>
      </div>

      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="kirimAdmin" checked>
        <label class="form-check-label" for="kirimAdmin">
          Kirim salinan ke Admin Pusat
        </label>
      </div>

      <button type="submit" class="btn btn-primary w-100">KIRIM PENDAFTARAN</button>
    </form>
  </div>

  <script>
  async function setLeaderFromURL() {
    const params = new URLSearchParams(window.location.search);
    const leaderSlug = params.get("leader");

    if (!leaderSlug) {
      console.warn("Tidak ada parameter leader di URL");
      return;
    }

    try {
      const res = await fetch("data/leader.json");
      const leaders = await res.json();
      const leader = leaders.find(l => l.slug === leaderSlug);

      if (leader) {
        const inputSponsor = document.querySelector('input[name="sponsor"]');
        inputSponsor.value = `${leader.id}${leader.code} - ${leader.name}`;
        inputSponsor.readOnly = true;

        const infoBox = document.createElement("div");
        infoBox.className = "leader-info";
        infoBox.innerHTML = `
          <strong>Bisnis dipresentasikan oleh:</strong><br>
          ${leader.id}${leader.code} - ${leader.name}
        `;
        inputSponsor.insertAdjacentElement("afterend", infoBox);

        sessionStorage.setItem("selectedLeader", JSON.stringify(leader));
        console.log("Leader terdeteksi:", leader.name);
      } else {
        alert("⚠️ Leader tidak ditemukan di database.");
      }
    } catch (err) {
      console.error("Gagal memuat leader.json:", err);
    }
  }

  document.addEventListener("DOMContentLoaded", setLeaderFromURL);

  document.getElementById("formPendaftaran").addEventListener("submit", function(e) {
    e.preventDefault();

    const leader = JSON.parse(sessionStorage.getItem("selectedLeader") || "{}");
    if (!leader.phone) {
      alert("Pilih leader terlebih dahulu melalui link yang benar.");
      return;
    }

    const nama = this.nama.value;
    const premi = this.premi.value;
    const wa = this.wa.value;

    const pesan = `Halo ${leader.name}, saya ingin mendaftar 3i Reborn.%0A
Nama: ${nama}%0A
No WA: ${wa}%0A
Premi: Rp ${premi}%0A
Disponsori oleh: ${leader.id}${leader.code} - ${leader.name}`;

    const urlWA = `https://wa.me/${leader.phone}?text=${pesan}`;
    window.open(urlWA, "_blank");

    if (document.getElementById("kirimAdmin").checked) {
      console.log("Salinan dikirim ke Admin Pusat (simulasi).");
    }
  });
  </script>

</body>
</html>

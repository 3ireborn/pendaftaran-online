<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NPA Motivation v5.1 â€” White-Blue Premium</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0b3d91">
  <link rel="icon" href="./asset/npa-icon-512.png" type="image/png">
  <style>
    body{font-family:Poppins,system-ui,sans-serif;margin:0;background:#f7faff;color:#0b3d91;}
    header{background:#0b3d91;color:white;padding:16px 20px;border-bottom:3px solid #0d57c5;}
    .wrap{max-width:900px;margin:auto;padding:20px;}
    h1{margin:0;font-size:22px;}
    .sub{font-size:13px;opacity:.9;}
    .card{background:white;padding:18px;border-radius:14px;box-shadow:0 6px 20px rgba(11,61,145,0.12);margin-top:18px;}
    .tag{display:inline-block;background:#eaf1ff;color:#0b3d91;padding:4px 10px;border-radius:999px;font-size:12px;margin-right:6px;}
    .row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
    select,textarea,button{border-radius:10px;border:1px solid #ccd;padding:10px;}
    select,button{font-weight:600;}
    button{background:#0b3d91;color:white;cursor:pointer;}
    button.alt{background:#eaf2ff;color:#0b3d91;}
    textarea{width:100%;min-height:100px;resize:vertical;}
    .msg{background:#eef5ff;border-left:4px solid #0b3d91;padding:12px;border-radius:10px;margin-top:10px;}
    .list .item{display:flex;justify-content:space-between;align-items:center;background:#f2f6ff;border:1px solid #ccd;border-radius:10px;padding:8px 12px;margin-top:6px;}
    .sent{background:#e7f9ef!important;border-color:#86dfa5!important;}
    .footer{text-align:center;color:#667;font-size:12px;margin-top:18px;}
    .timeinfo{font-size:13px;color:#667;margin-top:6px;}
  </style>
</head>
<body>
<header>
  <h1>ðŸ’¬ NPA Motivation v5.1</h1>
  <div class="sub">Smart Auto Broadcast by 3IReborn || NPA Team â€¢ Zona: <b>WIB (Asia/Jakarta)</b></div>
</header>
<main class="wrap">
  <div class="card">
    <span class="tag">AI Weekly Refresh</span>
    <span class="tag">Whiteâ€“Blue Premium</span>
    <div class="row">
      <span id="weekTag" class="tag">Minggu ke: ...</span>
      <span id="todayTag" class="tag">Hari: ...</span>
      <span id="timeTag" class="tag">Waktu: ...</span>
    </div>

    <div id="aiStatus" class="msg">Status AI: menunggu generate minggu ini...</div>
    <div class="row">
      <button id="btnAiRefresh">ðŸ¤– AI Refresh Minggu Ini</button>
      <button id="btnLoadToday" class="alt">ðŸ“… Muat Pesan Hari Ini</button>
      <select id="manualHour">
        <option>06:00</option><option>08:00</option><option>10:00</option>
        <option>12:00</option><option>17:00</option>
      </select>
    </div>

    <label class="timeinfo">Ketik motivasi manual (opsional):</label>
    <textarea id="manualText" placeholder="Tulis motivasi manual di sini bila ingin mengganti pesan AI untuk hari iniâ€¦"></textarea>
    <div id="preview" class="msg">Preview pesan akan tampil di siniâ€¦</div>

    <div class="row">
      <button id="btnSendAll">ðŸš€ Kirim ke Semua Leader</button>
      <button id="btnShowList" class="alt">ðŸ“‹ Tampilkan Daftar Leader</button>
    </div>

    <div class="footer">#Terkirim dengan ðŸ’ž dari NPA Smart System, Semangat Menembus Batas ðŸš€</div>
  </div>

  <div class="card" id="leadersCard" style="display:none">
    <h3>ðŸ“‹ Daftar Leader</h3>
    <div id="leaders" class="list"></div>
  </div>
</main>

<script>
const hariID=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const footerSig="\n\n#Terkirim dengan ðŸ’ž dari NPA Smart System, Semangat Menembus Batas ðŸš€";
const LEADERS_URL="./data/leaders.json";
let leaders=[],weekCache=null,sentCount=0;

const weekTag=document.getElementById("weekTag"),todayTag=document.getElementById("todayTag"),
timeTag=document.getElementById("timeTag"),aiStatus=document.getElementById("aiStatus"),
preview=document.getElementById("preview"),manualText=document.getElementById("manualText"),
manualHour=document.getElementById("manualHour"),leadersDiv=document.getElementById("leaders");

function toWIB(d=new Date()){return new Date(d.toLocaleString("en-US",{timeZone:"Asia/Jakarta"}));}
function getISOWeek(d){const date=toWIB(d);const target=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));const dayNr=(target.getUTCDay()+6)%7;target.setUTCDate(target.getUTCDate()-dayNr+3);const firstThursday=new Date(Date.UTC(target.getUTCFullYear(),0,4));const week=1+Math.round(((target-firstThursday)/86400000-3+((firstThursday.getUTCDay()+6)%7))/7);return`${target.getUTCFullYear()}-${String(week).padStart(2,'0')}`;}
function randPick(a){return a[Math.floor(Math.random()*a.length)];}
function buildMessageFor(day){const openers=["Mulai kecil, mulai sekarang.","Langkah kecil, hasil besar.","Allah melihat prosesmu.","Sedikit tapi konsisten."],cores=["Fokus pada yang bermanfaat.","Syukuri yang sudah ada.","Kalem tapi pasti.","Terus melangkah walau pelan."],closers=["Bismillah, terus berproses ðŸ’™","Doa dan kerja keras tak terpisah.","Semangat, rezeki menyukai yang tekun."];const base=(day==="Minggu")?"Minggu, isi ulang hati & strategi. ":(day==="Senin")?"Senin itu awal semangat. ":`${day}, lanjutkan perjuangan. `;return`${base}${randPick(openers)} ${randPick(cores)} ${randPick(closers)}`;}
function renderInfo(){const now=toWIB();weekTag.textContent=`Minggu ke: ${getISOWeek(now)}`;todayTag.textContent=`Hari: ${hariID[now.getDay()]}`;timeTag.textContent=`Waktu: ${now.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'})} WIB`;}
function composeToday(){const now=toWIB();const day=hariID[now.getDay()];const manual=manualText.value.trim();const text=(manual||weekCache?.[day]||buildMessageFor(day))+footerSig;preview.textContent=text;return text;}
async function aiRefresh(){const now=toWIB();const week=getISOWeek(now);const messages={};hariID.forEach(d=>messages[d]=buildMessageFor(d));weekCache=messages;aiStatus.textContent=`Status AI: generate ulang pesan minggu ${week}`;}
async function loadLeaders(){try{const r=await fetch(LEADERS_URL+'?v='+Date.now());leaders=await r.json();}catch(e){leaders=[];}renderLeaders();}
function renderLeaders(){leadersDiv.innerHTML='';leaders.forEach((L,i)=>{const div=document.createElement('div');div.className='item';div.innerHTML=`${i+1}. ${L.name} <span class='status'>Menunggu...</span>`;leadersDiv.appendChild(div);});}
function markSent(i){const item=leadersDiv.children[i];if(item){item.classList.add('sent');item.querySelector('.status').textContent='Terkirim ðŸŸ¢';}}
function waLink(phone,text){return`https://wa.me/${phone.replace(/[^\d]/g,'')}?text=${encodeURIComponent(text)}`;}
function sendAll(text){leaders.forEach((L,i)=>{setTimeout(()=>{window.open(waLink(L.phone,text),'_blank');markSent(i);},i*1200);});}
function init(){renderInfo();setInterval(renderInfo,1000);aiRefresh();loadLeaders();}
init();
document.getElementById("btnAiRefresh").onclick=aiRefresh;
document.getElementById("btnLoadToday").onclick=composeToday;
document.getElementById("btnSendAll").onclick=()=>sendAll(composeToday());
document.getElementById("btnShowList").onclick=()=>{document.getElementById("leadersCard").style.display="block";}
</script>
</body>
</html>

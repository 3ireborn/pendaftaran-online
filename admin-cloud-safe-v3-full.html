<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NPA Cloud Sync Admin ‚Äî Full (Safe)</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='62' fill='%231b7fff'/%3E%3Ctext x='50%' y='57%' dominant-baseline='middle' text-anchor='middle' font-size='68' fill='white' font-family='Arial'%3EN%3C/text%3E%3C/svg%3E">
<style>
:root{
  --bg:#0b1324;
  --card:#0e1a36;
  --muted:#8aa0c7;
  --text:#eaf1ff;
  --brand:#1b7fff;
  --brand2:#7a3bff;
  --ok:#16c172;
  --warn:#ffb020;
  --danger:#ff4d4f;
  --chip:#0f254d;
  --shadow: 0 10px 28px rgba(0,0,0,.35);
  --radius:20px;
}
*{box-sizing:border-box}
body{
  margin:0; background:
  radial-gradient(1200px 600px at -10% -10%, rgba(122,59,255,.35), transparent 60%),
  radial-gradient(900px 600px at 110% 10%, rgba(27,127,255,.30), transparent 60%),
  linear-gradient(180deg,#081020,#0b1324);
  color:var(--text); font: 500 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
}
.container{max-width:980px;margin:28px auto;padding:0 16px}
.header{background:linear-gradient(135deg,rgba(27,127,255,.25),rgba(122,59,255,.25));border:1px solid rgba(255,255,255,.06);backdrop-filter: blur(8px);padding:24px;border-radius:26px;box-shadow:var(--shadow)}
.hrow{display:flex;gap:14px;align-items:center}
.logo{width:46px;height:46px;border-radius:12px;background:conic-gradient(from 210deg,#1b7fff,#7a3bff,#ff4d7e);box-shadow:0 0 0 3px rgba(255,255,255,.08) inset}
h1{margin:0;font-size:26px;letter-spacing:.2px}
.badge{display:inline-flex;gap:8px;align-items:center;font-size:14px;background:#0f254d;border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;margin-top:10px}
.badge .dot{width:10px;height:10px;border-radius:50%;background:var(--ok);box-shadow:0 0 12px var(--ok)}
.section{margin-top:18px}
.card{background:rgba(7,15,34,.65);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.input{flex:1 1 220px;background:#0d1a33;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px 14px;color:var(--text);outline:none}
.input:focus{border-color:#2a6bff;box-shadow:0 0 0 3px rgba(42,107,255,.25)}
.btn{border:0;border-radius:14px;padding:14px 16px;font-weight:700;cursor:pointer;transition:.2s}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn-primary{background:linear-gradient(135deg,#1b7fff,#7a3bff);color:white}
.btn-ghost{background:#0f254d;color:#e9f2ff;border:1px solid rgba(255,255,255,.08)}
.btn-danger{background:linear-gradient(135deg,#ff6a6a,#ff3b3b);color:white}
.helper{color:var(--muted);font-size:14px;margin-top:6px}
.leader{display:flex;gap:14px;align-items:flex-start;background:rgba(11,21,44,.55);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:16px 14px;margin-top:14px}
.leader .icon{width:44px;height:44px;border-radius:12px;background:#0f254d;display:grid;place-items:center;font-size:20px}
.leader h3{margin:0 0 4px 0;font-size:18px}
.chips{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
.chip{display:inline-flex;gap:8px;align-items:center;background:#0f254d;color:#eaf1ff;border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:12px;font-weight:700;text-decoration:none}
.chip.green{background:rgba(22,193,114,.15);border-color:rgba(22,193,114,.35)}
.chip.red{background:rgba(255,77,79,.15);border-color:rgba(255,77,79,.35)}
.chip.gold{background:rgba(255,176,32,.15);border-color:rgba(255,176,32,.35)}
.small{font-size:13px;color:var(--muted)}
.copy{display:flex;align-items:center;gap:8px;margin-top:10px}
.copy button{border:1px dashed rgba(255,255,255,.18);background:transparent;color:#cfe2ff;padding:10px 12px;border-radius:10px;cursor:pointer}
hr.sep{border:0;border-top:1px solid rgba(255,255,255,.08);margin:18px 0}
.empty{padding:16px;border:1px dashed rgba(255,255,255,.12);border-radius:14px;color:var(--muted);text-align:center}
footer{opacity:.7;text-align:center;margin:26px 0}
code.kbd{background:#0d1a33;border:1px solid rgba(255,255,255,.12);padding:3px 6px;border-radius:6px}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="hrow">
        <div class="logo"></div>
        <div>
          <h1>NPA Cloud Sync <span style="font-weight:800">Admin</span></h1>
          <div id="loginBadge" class="badge"><span class="dot"></span> Login Aman ‚Äî Token Lokal</div>
        </div>
      </div>
    </div>

    <!-- Tambah Mitra -->
    <div class="section card">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <div class="icon">‚ûï</div>
        <div>
          <div style="font-weight:800;font-size:18px">Tambah Mitra Baru</div>
          <div class="helper">Nama & nomor WA akan dibuatkan slug otomatis dan tampil di daftar leader.</div>
        </div>
      </div>
      <div class="row">
        <input id="nameInput" class="input" placeholder="Nama Lengkap"/>
        <input id="phoneInput" class="input" placeholder="Nomor WA (contoh: 6285...)"/>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="addBtn" class="btn btn-primary">Tambah Sekarang</button>
        <button id="syncBtn" class="btn btn-ghost">üîÑ Sinkron ke Cloud</button>
        <button id="tokenBtn" class="btn btn-danger">üß© Ganti Token GitHub</button>
      </div>
      <div class="helper">Repo: <code class="kbd">3ireborn/pendaftaran-online</code> ‚Ä¢ File: <code class="kbd">data/leaders.json</code></div>
    </div>

    <!-- Daftar Leader -->
    <div class="section card">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
        <div class="icon">üåç</div><div style="font-weight:800;font-size:18px">Data Leader Aktif</div>
      </div>
      <div id="leadersWrap"></div>
      <div id="emptyState" class="empty" style="display:none">Belum ada data leader.</div>
    </div>

    <footer>¬© 2025 NPA Digital System ‚Äî Cloud Sync Safe</footer>
  </div>

<script>
/* ====== KONFIGURASI REPO ====== */
const GH_OWNER = "3ireborn";
const GH_REPO  = "pendaftaran-online";
const GH_PATH  = "data/leaders.json";
const RAW_URL  = `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/main/${GH_PATH}`;
const API_URL  = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;

/* ====== STATE ====== */
let leaders = [];
let pendingAdds = []; // mitra baru lokal, belum terpadu ke cloud

/* ====== UTIL ====== */
const el = sel => document.querySelector(sel);
const slugify = (s) => s.toString().toLowerCase()
  .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
  .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'').replace(/--+/g,'-');

const onlyDigits = s => (s||'').replace(/[^\d]/g,'');
const nextCode = (arr, id2) => {
  const same = arr.filter(x=>x.id===id2).map(x=>parseInt(x.code,10)).filter(n=>!isNaN(n));
  const max = same.length? Math.max(...same):0;
  return String(max+1).padStart(3,"0");
};

function showToast(msg){
  alert(msg);
}

/* ====== TOKEN MANAGEMENT (SAFE) ====== */
function getToken(){
  return localStorage.getItem('npa_github_token')||'';
}
function setTokenSecure(){
  const current = getToken();
  const t = prompt("Tempel Personal Access Token (repo scope). \nTidak akan disimpan di server ‚Äî hanya lokal HP kamu.", current);
  if (t===null) return;
  localStorage.setItem('npa_github_token', t.trim());
  showToast("Token tersimpan lokal ‚úÖ");
  renderLoginBadge();
}
function renderLoginBadge(){
  const b = el('#loginBadge');
  const has = !!getToken();
  b.innerHTML = `<span class="dot" style="background:${has?'#16c172':'#ff4d4f'};box-shadow:0 0 12px ${has?'#16c172':'#ff4d4f'}"></span> ${has?'Login Aman ‚Äî Token Lokal ‚úÖ':'Belum set Token ‚Äî Hanya Mode Lokal'}`;
}

/* ====== LOAD LEADERS DARI CLOUD ====== */
async function loadLeaders(){
  try{
    const res = await fetch(RAW_URL, {cache:'no-store'});
    if(!res.ok) throw new Error('Gagal memuat leaders.json');
    leaders = await res.json();
  }catch(e){
    console.warn(e);
    leaders = [];
  }
  renderLeaders();
}

/* ====== RENDER LIST ====== */
function renderLeaders(){
  const wrap = el('#leadersWrap');
  wrap.innerHTML = '';
  const list = [...leaders, ...pendingAdds];
  if(!list.length){ el('#emptyState').style.display='block'; return; }
  el('#emptyState').style.display='none';

  list.forEach(l=>{
    const fullCode = `${l.id}${l.code}`; // ex: SK001
    const base = location.origin + location.pathname.replace(/\/[^\/]*$/,''); // /pendaftaran-online
    const linkPendaftaran = `${base}/index-v2.html?leader=${encodeURIComponent(l.slug)}`;
    const lpMaster = `${base}/master-lp.html?leader=${encodeURIComponent(l.slug)}`;
    const lpHot    = `${base}/hot-lp.html?leader=${encodeURIComponent(l.slug)}`;
    const aiTools  = `${base}/ai-facebook.html?leader=${encodeURIComponent(l.slug)}`;
    const wa       = `https://wa.me/${l.phone}`;

    const box = document.createElement('div');
    box.className = 'leader';
    box.innerHTML = `
      <div class="icon">ü™™</div>
      <div style="flex:1">
        <h3>${fullCode} ‚Äî ${l.name}</h3>
        <div class="small">üìû ${l.phone} ‚Ä¢ slug: <code class="kbd">${l.slug}</code></div>
        <div class="chips">
          <a class="chip green" href="${lpMaster}" target="_blank">üåê LP Master</a>
          <a class="chip red" href="${lpHot}" target="_blank">üî• LP Hot</a>
          <a class="chip" style="background:rgba(122,59,255,.18);border-color:rgba(122,59,255,.35)" href="${aiTools}" target="_blank">ü§ñ AI Tools</a>
          <a class="chip gold" href="${wa}" target="_blank">üìû WhatsApp</a>
          <a class="chip" href="${linkPendaftaran}" target="_blank">üîó Link Pendaftaran</a>
        </div>
        <div class="copy">
          <button data-url="${linkPendaftaran}" onclick="copyLink(this)">üìé Copy Link Pendaftaran</button>
        </div>
      </div>
    `;
    wrap.appendChild(box);
  });
}
window.copyLink = (btn)=>{
  const url = btn.getAttribute('data-url');
  navigator.clipboard.writeText(url).then(()=>{
    btn.textContent = "‚úÖ Tersalin";
    setTimeout(()=>btn.textContent="üìé Copy Link Pendaftaran",1300);
  });
};

/* ====== TAMBAH LOKAL ====== */
function addLocal(){
  const name = el('#nameInput').value.trim();
  const phone = onlyDigits(el('#phoneInput').value.trim());
  if(!name) return showToast("Nama wajib diisi.");
  if(!phone || !/^(\d{8,16})$/.test(phone)) return showToast("No WA tidak valid (gunakan angka, contoh 62812...).");

  const id2 = (name.split(' ').map(w=>w[0]).join('').slice(0,2) || 'ID').toUpperCase(); // inisial 2 huruf
  const code = nextCode([...leaders, ...pendingAdds], id2);
  const slug = slugify(name);
  pendingAdds.push({id:id2, code, name, phone, slug});
  el('#nameInput').value=''; el('#phoneInput').value='';
  renderLeaders();
  showToast("Ditambah lokal ‚úÖ ‚Äî klik Sinkron ke Cloud untuk upload.");
}

/* ====== SINKRON KE CLOUD (PUT FILE) ====== */
async function syncToCloud(){
  const token = getToken();
  if(!token){ showToast("Set token dulu ya."); return; }
  try{
    // 1) ambil file + sha
    const getRes = await fetch(API_URL, {headers:{Authorization:`Bearer ${token}`,Accept:'application/vnd.github+json'}});
    if(!getRes.ok) throw new Error('Gagal mengambil leaders.json dari API');
    const file = await getRes.json();
    const sha = file.sha;
    let cloudArr = JSON.parse(atob(file.content));

    // 2) gabungkan unique by slug
    const bySlug = new Map(cloudArr.map(x=>[x.slug, x]));
    pendingAdds.forEach(p=>bySlug.set(p.slug, p));
    const merged = Array.from(bySlug.values());

    // 3) PUT kembali
    const putRes = await fetch(API_URL,{
      method:'PUT',
      headers:{
        Authorization:`Bearer ${token}`,
        Accept:'application/vnd.github+json',
        'Content-Type':'application/json'
      },
      body:JSON.stringify({
        message:`sync: update leaders.json via admin-cloud-safe-v3-full`,
        content: btoa(unescape(encodeURIComponent(JSON.stringify(merged,null,2)))),
        sha
      })
    });
    if(!putRes.ok) throw new Error('Gagal mengunggah perubahan ke GitHub');
    pendingAdds = [];
    showToast("Sinkron ke Cloud sukses ‚úÖ");
    await loadLeaders();
  }catch(e){
    console.error(e);
    showToast("Sinkron gagal ‚ùå. Cek token & izin (scope repo).");
  }
}

/* ====== EVENTS ====== */
el('#addBtn').addEventListener('click', addLocal);
el('#syncBtn').addEventListener('click', syncToCloud);
el('#tokenBtn').addEventListener('click', setTokenSecure);

/* ====== INIT ====== */
renderLoginBadge();
loadLeaders();
</script>
</body>
</html>

<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Referral Generator â€” NPA Smart System (Final)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--text:#e6eef8;--muted:#9fb0d8;--accent:#1e40af;--gold:#d4af37}
    *{box-sizing:border-box}
    body{margin:0;font-family:Poppins,system-ui,Segoe UI,Roboto,Arial;color:var(--text);background:linear-gradient(180deg,#05060a 0%, #071029 100%);padding:22px}
    .wrap{max-width:980px;margin:0 auto}
    h1{margin:0 0 12px;font-size:20px;color:var(--text)}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:16px;border-radius:12px}
    label{display:block;font-weight:600;color:var(--muted);font-size:13px;margin-bottom:6px}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
    .row{display:flex;gap:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#2563eb);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)}
    .links{margin-top:12px}
    .links a{display:block;color:#cfe5ff;text-decoration:underline;margin:6px 0;word-break:break-all}
    .actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:13px}
    /* Social card preview */
    .preview{background:linear-gradient(180deg,#071029,#021026);padding:12px;border-radius:12px;border:2px solid rgba(212,175,55,0.06)}
    .card-canvas{width:320px;height:400px;background:#081226;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .small{font-size:12px;color:var(--muted)}
    .qr-wrap{width:84px;height:84px;background:white;padding:6px;border-radius:10px}
    .footer-note{margin-top:10px;color:var(--muted);font-size:12px}
    .gold-stroke{box-shadow:0 0 0 2px rgba(212,175,55,0.06) inset;border:2px solid rgba(212,175,55,0.08)}
    .copy{background:#0b1220;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
    @media(max-width:900px){.grid{grid-template-columns:1fr}.card-canvas{width:300px;height:375px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Referral Generator â€” NPA Smart System (Dark Elegant â€¢ Biru+Emas)</h1>
    <p class="muted">Hasil: 3 tautan live (LP Master, LP Hot, Pendaftaran). Social Card square (4:5) + QR + Copy/Share ke WhatsApp.</p><div class="grid" style="margin-top:12px">
  <!-- LEFT: Form -->
  <div class="card gold-stroke">
    <label>1) Nama Leader (untuk tampil di link & social card)</label>
    <input id="leaderName" placeholder="Contoh: Sugiarto KSM" value="Sugiarto KSM">

    <label style="margin-top:10px">2) No. WhatsApp Leader (format: 628...)</label>
    <input id="leaderWA" placeholder="Contoh: 6285218453131" value="6285218453131">

    <label style="margin-top:10px">3) Slug (unik, tanpa spasi)</label>
    <input id="leaderSlug" placeholder="Contoh: sugiarto-ksm" value="sugiarto-ksm">

    <div style="margin-top:12px" class="row">
      <button class="btn btn-primary" id="genBtn">Buat Link & QR</button>
      <button class="btn btn-ghost" id="clearBtn">Reset</button>
    </div>

    <div class="links card" id="linksBox" style="margin-top:12px;display:none">
      <div class="muted">Link Live (Salin / Share)</div>
      <a id="linkMaster" href="#" target="_blank"></a>
      <a id="linkHot" href="#" target="_blank"></a>
      <a id="linkForm" href="#" target="_blank"></a>

      <div class="actions">
        <button class="btn btn-primary" id="copyAll">Copy ALL Links</button>
        <button class="btn btn-ghost" id="shareWA">Bagikan lewat WhatsApp</button>
        <button class="btn btn-ghost" id="downloadCard">Simpan Social Card (PNG)</button>
      </div>
    </div>

    <div style="margin-top:12px" class="muted">Preview teks untuk caption (tinggal paste di komentar Facebook):</div>
    <div id="captionBox" style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;margin-top:8px;font-size:13px;white-space:pre-wrap">â€”</div>

    <div class="footer-note">Footer: Powered by NPA Smart System || 3IReborn</div>
  </div>

  <!-- RIGHT: Preview + Upload -->
  <div class="card preview">
    <label>Upload Foto Leader (opsional)</label>
    <input type="file" id="photoInput" accept="image/*" style="margin-bottom:8px">
    <div style="display:flex;gap:12px;align-items:center">
      <div class="card-canvas" id="canvasWrap">
        <canvas id="socialCanvas" width="400" height="500" style="width:320px;height:400px;border-radius:8px"></canvas>
      </div>
      <div style="flex:1">
        <div class="small muted">QR Code</div>
        <div id="qrHolder" style="margin-top:8px"></div>
        <div style="margin-top:12px">
          <div class="small muted">Preview ukuran: 4:5 (Feed). Jika butuh ukuran lain, mendownload & crop sesuai kebutuhan.</div>
          <div style="margin-top:8px"><button class="btn btn-primary" id="regenBtn">Perbarui Social Card</button></div>
        </div>
      </div>
    </div>
  </div>
</div>

<p style="margin-top:10px" class="muted">Catatan: file statis â€” tidak perlu token / backend. Link dibuat berdasarkan URL standar project.</p>

  </div>  <!-- Libraries -->  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>  <script>
    // Config â€” gunakan versi yang stabil (sesuaikan jika path lain)
    const BASE = location.origin + '/pendaftaran-online';
    const PATH_MASTER = BASE + '/lp-master-v6.6.html';
    const PATH_HOT = BASE + '/lp-hot-v6.6.html';
    const PATH_FORM = BASE + '/form-pendaftaran-v3.1.html';

    const $ = id => document.getElementById(id);
    const canvas = $('socialCanvas');
    const ctx = canvas.getContext('2d');
    let uploadedImage = null;

    function makeLinks(name, wa, slug){
      const qName = encodeURIComponent(name);
      const qWa = encodeURIComponent(wa);
      const qSlug = encodeURIComponent(slug);
      const lm = PATH_MASTER + '?name=' + qName + '&wa=' + qWa + '&slug=' + qSlug;
      const lh = PATH_HOT + '?name=' + qName + '&wa=' + qWa + '&slug=' + qSlug;
      const lf = PATH_FORM + '?name=' + qName + '&wa=' + qWa + '&slug=' + qSlug;
      return {lm,lh,lf};
    }

    function generateCaption(name, slug){
      return `ðŸ”¹ *Mengapa harus 3IReborn?*\n\nHalo! Saya ${name}. Yuk kenalan dulu â€” cek tawaran ringkas di LP saya. Jika tertarik, klik komentar dan hubungi via WA.` +
        `\n\nLP Master: ${PATH_MASTER}?name=${encodeURIComponent(name)}&slug=${encodeURIComponent(slug)}`;
    }

    function drawSocialCard(name, wa, slug, qrDataUrl){
      // Canvas 400x500 base (we scale for display)
      // background dark gradient
      const w = canvas.width, h = canvas.height;
      // clear
      ctx.clearRect(0,0,w,h);
      // background
      const g = ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0,'#071029'); g.addColorStop(1,'#021026');
      ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

      // gold rounded band top
      ctx.fillStyle = 'rgba(212,175,55,0.06)';
      roundRect(ctx,12,12,w-24,110,12,true,false);

      // photo area
      if(uploadedImage){
        // draw image with cover
        const img = uploadedImage;
        const targetW = w-48, targetH = 220; const tx = 24, ty = 32;
        // cover crop
        const ratio = Math.max(targetW/img.width, targetH/img.height);
        const sx = (img.width - targetW/ratio)/2;
        const sy = (img.height - targetH/ratio)/2;
        ctx.drawImage(img, sx, sy, targetW/ratio, targetH/ratio, tx, ty, targetW, targetH);
      } else {
        // placeholder
        ctx.fillStyle = '#061424'; roundRect(ctx,24,32,w-48,220,10,true,false);
        ctx.fillStyle = '#6fa8ff'; ctx.font = '600 20px Poppins'; ctx.textAlign='center'; ctx.fillText('Foto Leader', w/2, 150);
      }

      // name text
      ctx.fillStyle = '#e6eef8'; ctx.font = '700 22px Poppins'; ctx.textAlign='left';
      ctx.fillText(name || 'Nama Leader', 24, 280);
      ctx.fillStyle = '#9fb0d8'; ctx.font = '14px Poppins'; ctx.fillText(wa ? ('WA: ' + wa) : 'No WA', 24, 304);

      // QR
      if(qrDataUrl){
        const qrImg = new Image(); qrImg.onload = ()=>{
          const qSize = 120; const qx = w - qSize - 24; const qy = h - qSize - 24;
          // white box
          ctx.fillStyle = '#fff'; roundRect(ctx, qx-8, qy-8, qSize+16, qSize+16, 12, true, false);
          ctx.drawImage(qrImg, qx, qy, qSize, qSize);
          // small label
          ctx.fillStyle = '#0b1220'; ctx.font='12px Poppins'; ctx.textAlign='center'; ctx.fillText('Scan untuk daftar', qx+qSize/2, qy+qSize+20);
        };
        qrImg.src = qrDataUrl;
      }

      // footer gold line
      ctx.fillStyle = 'rgba(212,175,55,0.9)'; ctx.fillRect(24, h-10, w-48, 6);

      // branding
      ctx.fillStyle = '#cfe5ff'; ctx.font='12px Poppins'; ctx.fillText('NPA Smart System || 3IReborn', 24, h-18);
    }

    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      if(typeof r==='undefined') r=5; if(typeof stroke==='undefined') stroke=true;
      ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath();
      if(fill) ctx.fill(); if(stroke) ctx.stroke();
    }

    // QR util (QRious)
    function makeQR(text, size=240){
      const qr = new QRious({value:text,size:size,level:'H'});
      return qr.toDataURL();
    }

    // events
    $('genBtn').addEventListener('click',()=>{
      const name = $('leaderName').value.trim();
      const wa = $('leaderWA').value.replace(/\s+/g,'').trim();
      let slug = $('leaderSlug').value.trim();
      if(!name||!wa||!slug){alert('Isi semua field: Nama, WA, Slug');return}
      // build links
      const {lm,lh,lf} = makeLinks(name,wa,slug);
      $('linkMaster').textContent = 'ðŸŒ LP Master: ' + lm; $('linkMaster').href = lm;
      $('linkHot').textContent = 'ðŸ”¥ LP Hot: ' + lh; $('linkHot').href = lh;
      $('linkForm').textContent = 'ðŸ“ Form Pendaftaran: ' + lf; $('linkForm').href = lf;
      $('linksBox').style.display='block';
      // caption
      $('captionBox').textContent = generateCaption(name,slug);

      // QR
      const qrData = makeQR(lm);
      // render QR dom
      $('qrHolder').innerHTML = '';
      const img = document.createElement('img'); img.src = qrData; img.style.width='92px'; img.style.height='92px'; img.style.borderRadius='8px'; img.style.background='#fff';
      $('qrHolder').appendChild(img);

      // draw social card
      drawSocialCard(name,wa,slug,qrData);

      // store to local cache for quick access
      try{
        const cache = JSON.parse(localStorage.getItem('ref_cache')||'[]');
        cache.unshift({name,wa,slug,ts:Date.now()}); localStorage.setItem('ref_cache', JSON.stringify(cache.slice(0,50)));
      }catch(e){}
    });

    $('clearBtn').addEventListener('click',()=>{ $('leaderName').value=''; $('leaderWA').value=''; $('leaderSlug').value=''; $('linksBox').style.display='none'; $('captionBox').textContent='â€”'; $('qrHolder').innerHTML=''; ctx.clearRect(0,0,canvas.width,canvas.height); });

    $('copyAll').addEventListener('click',()=>{
      const lm = $('linkMaster').href||''; const lh = $('linkHot').href||''; const lf = $('linkForm').href||'';
      const text = `${lm}\n${lh}\n${lf}`;
      navigator.clipboard.writeText(text).then(()=>alert('Semua link disalin ke clipboard'));
    });

    $('shareWA').addEventListener('click',()=>{
      const lm = $('linkMaster').href||''; const text = encodeURIComponent('Cek tawaran ini: '+lm);
      window.open('https://wa.me/?text='+text,'_blank');
    });

    $('regenBtn').addEventListener('click',()=>{
      // redraw with latest values
      const name = $('leaderName').value.trim(); const wa = $('leaderWA').value.replace(/\s+/g,'').trim(); const slug = $('leaderSlug').value.trim();
      if(!name||!wa||!slug){alert('Isi semua field dulu');return}
      const qrData = makeQR(PATH_MASTER+'?name='+encodeURIComponent(name)+'&wa='+encodeURIComponent(wa)+'&slug='+encodeURIComponent(slug));
      drawSocialCard(name,wa,slug,qrData);
      $('qrHolder').innerHTML=''; const img=document.createElement('img'); img.src=qrData; img.style.width='92px'; img.style.height='92px'; img.style.borderRadius='8px'; img.style.background='#fff'; $('qrHolder').appendChild(img);
    });

    // photo upload
    $('photoInput').addEventListener('change', (ev)=>{
      const f = ev.target.files[0]; if(!f) return; const img = new Image(); const reader = new FileReader();
      reader.onload = e => { img.onload = ()=>{ uploadedImage = img; drawSocialCard($('leaderName').value, $('leaderWA').value, $('leaderSlug').value, makeQR(PATH_MASTER+'?name='+encodeURIComponent($('leaderName').value)) ); }; img.src = e.target.result; };
      reader.readAsDataURL(f);
    });

    // download card
    $('downloadCard').addEventListener('click',()=>{
      // convert canvas to blob and download
      canvas.toBlob(blob=>{
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'social-card-'+Date.now()+'.png'; a.click(); URL.revokeObjectURL(a.href);
      });
    });

    // initial placeholder draw
    drawSocialCard('Nama Leader','628...','slug', null);
  </script></body>
    </html>
